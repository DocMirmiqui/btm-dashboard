var Mr=Object.defineProperty;var Tr=(n,t,e)=>t in n?Mr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var a=(n,t,e)=>Tr(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const h of s.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();function Cr(n,t){if(t!==void 0){if(typeof t=="string"){n.textContent=t;return}if(t instanceof Node){n.append(t);return}if(t instanceof Array)for(const e of t)(e instanceof Node||typeof e=="string")&&n.append(e)}}function Ui(n){let t="";for(let e=0;e<n.length;e++){if(n[e]===n[e].toUpperCase()){t+="-"+n[e].toLowerCase();continue}t+=n[e]}return t}function Sr(n){let t="";for(const e in n)t+=`${Ui(e)}: ${n[e]};`;return t}function Rr(n,t){if(typeof t!="string"&&t!==void 0){t.style!==void 0&&(n.setAttribute("style",Sr(t.style)),delete t.style);for(const e in t){if(e[0]==="o"&&e[1]==="n"){n.addEventListener(e.substring(2).toLowerCase(),t[e]);continue}if(typeof t[e]=="boolean"){n.toggleAttribute(e.substring(+(e[0]==="\\")),t[e]);return}n.setAttribute(Ui(e.substring(+(e[0]==="\\"))),String(t[e]))}}}const tt=void 0,x=new Proxy({},{get(n,t){return(e,i)=>{if(e instanceof HTMLElement)return console.error(`Can not use HTMLElement as options. Caught at: ${String(t)}`),document.createElement(String(t));const r=document.createElement(t);return typeof e=="string"?r.className=String(e):e!==void 0&&"class"in e&&(r.className=String(e.class),delete e.class),Rr(r,e),Cr(r,i),r}}});function V(n,t=document){return t.querySelector(n)}function l(n){return n!=null}function oi(n){if(!l(n))throw new Error("Is-Assertion failed x does not have defined value");return n}function He(n){return x.i("nf "+n)}class F{static clamp(t,e,i){return t>=i?i:t<=e?e:t}static round(t,e){if(e<1)return Math.round(t);const i=Math.pow(10,e);return Math.round(t*i)/i}static normalize(t,e,i){return(i-t)/(e-t)}static lerp(t,e,i){return t+(e-t)*i}static smoothStep(t){return 6*t**5-15*t**4+10*t**3}static lerpColor(t,e,i){return glm.vec3(F.lerp(t.x,e.x,i),F.lerp(t.y,e.y,i),F.lerp(t.z,e.z,i))}static is2PowX(t){return(t&t-1)===0}}const at=class at{static clone(t){return glm.vec3(t)}static min(t,e){return glm.vec3(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z))}static max(t,e){return glm.vec3(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z))}static clamp(t,e,i){return at.min(at.max(t,i),e)}static exp(t){return glm.vec3(Math.exp(t.x),Math.exp(t.y),Math.exp(t.z))}static equal(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}static rgb(t,e,i){return glm.vec3(t/255,e/255,i/255)}static print(t){console.log({x:t.x,y:t.y,z:t.z})}static lerp(t,e,i){return glm.vec3(F.lerp(t.x,e.x,i),F.lerp(t.y,e.y,i),F.lerp(t.z,e.z,i))}};a(at,"ZERO",glm.vec3(0,0,0)),a(at,"MIN",glm.vec3(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE)),a(at,"MAX",glm.vec3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),a(at,"FORWARD",glm.vec3(0,0,1)),a(at,"LEFT",glm.vec3(1,0,0)),a(at,"UP",glm.vec3(0,1,0)),a(at,"X",glm.vec3(1,0,0)),a(at,"Y",glm.vec3(0,1,0)),a(at,"Z",glm.vec3(0,0,1));let y=at;class ke{}a(ke,"IDENTITY",glm.mat4(1));class Oe{static convertPoint3(t){return glm.vec4(t.x,t.y,t.z,1)}static convertVector3(t){return glm.vec4(t.x,t.y,t.z,0)}}class Pr{constructor(t=glm.vec3(0,0,0),e=glm.quat(glm.vec3(0,0,0)),i=glm.vec3(1,1,1)){a(this,"_gameObject");a(this,"_matrix");a(this,"_inverseMatrix");a(this,"_parent");a(this,"_children");this.position=t,this.rotation=e,this.scale=i,this._matrix=void 0,this._children=[]}bind(t){this._gameObject=t}get gameObject(){return this._gameObject}unsetMatrix(){this._matrix=void 0,this._inverseMatrix=void 0}getPosition(){return this.position}getWorldPosition(){return glm.vec3(this.getParentMatrix()["*"](Oe.convertPoint3(this.position)))}setPosition(t){return this.unsetMatrix(),this.position.x=t.x,this.position.y=t.y,this.position.z=t.z,this}setPosition3(t,e,i){return this.setPosition(glm.vec3(t,e,i))}getRotation(){return this.rotation}setRotation(t){return this.unsetMatrix(),this.rotation.x=t.x,this.rotation.y=t.y,this.rotation.z=t.z,this.rotation.w=t.w,this}getScale(){return this.scale}setScale(t){return this.unsetMatrix(),this.scale.x=t.x,this.scale.y=t.y,this.scale.z=t.z,this}setScale3(t,e,i){return this.setScale(glm.vec3(t,e,i))}getMatrix(){return l(this._matrix)?this._matrix:(this._matrix=glm.translate(this.position)["*"](glm.toMat4(this.rotation))["*"](glm.scale(this.scale)),this._matrix)}getInverseMatrix(){return l(this._inverseMatrix)?this._inverseMatrix:(this._inverseMatrix=glm.inverse(this.getMatrix()),this._inverseMatrix)}getForward(){return this.rotation["*"](y.FORWARD)}getLeft(){return this.rotation["*"](y.LEFT)}getUp(){return this.rotation["*"](y.UP)}lookAtTransform(t,e=y.UP){this.lookAt(t.position,e)}lookAt(t,e=y.UP){const i=glm.normalize(t["-"](this.position));Math.abs(glm.dot(i,e))>.99999&&(e=y.LEFT);const r=glm.normalize(glm.cross(e,i)),s=glm.cross(i,r),h=glm.mat4(glm.vec4(r.x,r.y,r.z,0),glm.vec4(s.x,s.y,s.z,0),glm.vec4(i.x,i.y,i.z,0),glm.vec4(0,0,0,1));this.setRotation(glm.quat(h))}rotate(t,e){const i=glm.normalize(t),r=Math.cos(e/2),s=Math.sin(e/2);this.setRotation(glm.quat(r,i["*"](s)))}rotateDegrees(t,e){this.rotate(t,glm.radians(e))}getParentMatrix(){return l(this._parent)?this._parent.getParentMatrix()["*"](this.getMatrix()):ke.IDENTITY}getParent(){return this._parent}getChildren(){return this._children}addChildTransform(t){this._children.push(t),t._parent=this}addChild(t){t.removeFromScene(),this.addChildTransform(t.transform)}}function Ar(n){return typeof n.draw=="function"&&typeof n.getBoundingBox=="function"}class ci{constructor(t=0){a(this,"n");this.n=t}increment(){return this.n++}peek(){return this.n}}const li="windowOpened",hi="windowClosed",zi="windowMinimized",Gi="windowMaximized";let Ot,ue,Kt=!1;const jt=[];window.addEventListener("load",()=>{Ot=x.div("window-overlay"),ue=x.div("window-overlay-active"),document.body.append(Ot,ue),Kt=!0;for(const n of jt)n.fn(n.arg);jt.length=0});function Rt(n){if(!Kt){jt.push({fn:Rt,arg:n});return}Wi(n),n.style.left="50%",n.style.top="50%",n.classList.remove("hide"),n.dispatchEvent(new CustomEvent(li)),ue==null||ue.appendChild(n)}function di(n,t,e){n.style.left=String(t/window.innerWidth*100)+"%",n.style.top=String(e/window.innerHeight*100)+"%"}function ui(n,t=void 0,e=void 0){if(!Kt){jt.push({fn:ui,arg:n});return}const i=V(".content",n);if(!l(i))return;const r=n.getBoundingClientRect();i.classList.add("hide"),n.style.height="unset";const s=n.getBoundingClientRect();di(n,r.x+s.width/2,r.y+s.height/2),e??(e=V(".minimize",n)),t??(t=V(".maximize",n)),!(!l(e)||!l(t))&&(e.classList.add("hide"),t.classList.remove("hide"),n.dispatchEvent(new CustomEvent(zi)))}function Wi(n,t=void 0,e=void 0){if(!Kt){jt.push({fn:ui,arg:n});return}const i=V(".content",n);if(!l(i))return;const r=n.getBoundingClientRect();i.classList.remove("hide"),n.style.height=n.dataset.height??"unset";const s=n.getBoundingClientRect();di(n,r.x+s.width/2,r.y+s.height/2),e??(e=V(".minimize",n)),t??(t=V(".maximize",n)),!(!l(e)||!l(t))&&(t.classList.add("hide"),e.classList.remove("hide"),n.dispatchEvent(new CustomEvent(Gi)))}function Hi(n){if(!Kt){jt.push({fn:Hi,arg:n});return}n.classList.add("hide"),Ot==null||Ot.appendChild(n),n.dispatchEvent(new CustomEvent(hi))}function Or(n){var h;n.classList.add("draggable");const t=V(".head",n);if(!l(t))return;let e=!1,i,r,s;t.addEventListener("pointerdown",f=>{e=!0,i=n.getBoundingClientRect(),r=f.clientX-i.x,s=f.clientY-i.y,t.setPointerCapture(f.pointerId)}),t.addEventListener("pointerup",f=>{e=!1,t.releasePointerCapture(f.pointerId)}),t.addEventListener("pointermove",f=>{if(!e||!l(r)||!l(s)||!l(i))return;const m=f.clientX-r+i.width/2,p=f.clientY-s+i.height/2;di(n,m,p)}),(h=V(".controls",t))==null||h.addEventListener("pointerdown",f=>{f.stopImmediatePropagation()})}function Xi(n){var i,r;if(!Kt){jt.push({fn:Xi,arg:n});return}(i=n.parentElement)!=null&&i.classList.contains("window-overlay-active")||(Ot==null||Ot.appendChild(n),n.classList.add("hide")),n.dataset.windowDraggable&&Or(n),(r=V(".close",n))==null||r.addEventListener("click",()=>{Hi(n)});const t=V(".minimize",n),e=V(".maximize",n);!l(t)||!l(e)||(t.classList.remove("hide"),e.classList.add("hide"),t.addEventListener("click",()=>{ui(n,e,t)}),e.addEventListener("click",()=>{Wi(n,e,t)}))}function pe(n,t,e={}){const i=[x.button("close",He("nf-fa-close"))];e.isMinimizable===!0&&i.unshift(x.button("minimize",He("nf-fa-window_minimize")),x.button("maximize",He("nf-fa-window_maximize")));const r=x.div({class:"window hide"},[x.div("head",[x.span(tt,n),x.div("controls",i)]),x.div("content",t)]);return r.dataset.width=r.style.width=e.width??"300px",r.dataset.height=r.style.height=e.height??"unset",e.isDraggable===!0&&(r.dataset.windowDraggable="true"),Xi(r),r}var Pi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ai={};/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Oi;function Lr(){if(Oi)return Ai;Oi=1;var n;return function(t){(function(e){var i=typeof globalThis=="object"?globalThis:typeof Pi=="object"?Pi:typeof self=="object"?self:typeof this=="object"?this:m(),r=s(t);typeof i.Reflect<"u"&&(r=s(i.Reflect,r)),e(r,i),typeof i.Reflect>"u"&&(i.Reflect=t);function s(p,S){return function(C,I){Object.defineProperty(p,C,{configurable:!0,writable:!0,value:I}),S&&S(C,I)}}function h(){try{return Function("return this;")()}catch{}}function f(){try{return(0,eval)("(function() { return this; })()")}catch{}}function m(){return h()||f()}})(function(e,i){var r=Object.prototype.hasOwnProperty,s=typeof Symbol=="function",h=s&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",f=s&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",m=typeof Object.create=="function",p={__proto__:[]}instanceof Array,S=!m&&!p,C={create:m?function(){return We(Object.create(null))}:p?function(){return We({__proto__:null})}:function(){return We({})},has:S?function(c,d){return r.call(c,d)}:function(c,d){return d in c},get:S?function(c,d){return r.call(c,d)?c[d]:void 0}:function(c,d){return c[d]}},I=Object.getPrototypeOf(Function),R=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:yr(),N=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:br(),it=typeof WeakMap=="function"?WeakMap:wr(),G=s?Symbol.for("@reflect-metadata:registry"):void 0,D=pr(),rt=vr(D);function ct(c,d,u,g){if(M(u)){if(!wi(c))throw new TypeError;if(!xi(d))throw new TypeError;return Xt(c,d)}else{if(!wi(c))throw new TypeError;if(!W(d))throw new TypeError;if(!W(g)&&!M(g)&&!gt(g))throw new TypeError;return gt(g)&&(g=void 0),u=mt(u),Yt(c,d,u,g)}}e("decorate",ct);function ft(c,d){function u(g,T){if(!W(g))throw new TypeError;if(!M(T)&&!gr(T))throw new TypeError;ne(c,d,g,T)}return u}e("metadata",ft);function nt(c,d,u,g){if(!W(u))throw new TypeError;return M(g)||(g=mt(g)),ne(c,d,u,g)}e("defineMetadata",nt);function lt(c,d,u){if(!W(d))throw new TypeError;return M(u)||(u=mt(u)),Ue(c,d,u)}e("hasMetadata",lt);function et(c,d,u){if(!W(d))throw new TypeError;return M(u)||(u=mt(u)),Me(c,d,u)}e("hasOwnMetadata",et);function Ft(c,d,u){if(!W(d))throw new TypeError;return M(u)||(u=mt(u)),re(c,d,u)}e("getMetadata",Ft);function Et(c,d,u){if(!W(d))throw new TypeError;return M(u)||(u=mt(u)),se(c,d,u)}e("getOwnMetadata",Et);function kt(c,d){if(!W(c))throw new TypeError;return M(d)||(d=mt(d)),ae(c,d)}e("getMetadataKeys",kt);function ie(c,d){if(!W(c))throw new TypeError;return M(d)||(d=mt(d)),oe(c,d)}e("getOwnMetadataKeys",ie);function Ee(c,d,u){if(!W(d))throw new TypeError;if(M(u)||(u=mt(u)),!W(d))throw new TypeError;M(u)||(u=mt(u));var g=le(d,u,!1);return M(g)?!1:g.OrdinaryDeleteMetadata(c,d,u)}e("deleteMetadata",Ee);function Xt(c,d){for(var u=c.length-1;u>=0;--u){var g=c[u],T=g(d);if(!M(T)&&!gt(T)){if(!xi(T))throw new TypeError;d=T}}return d}function Yt(c,d,u,g){for(var T=c.length-1;T>=0;--T){var U=c[T],H=U(d,u,g);if(!M(H)&&!gt(H)){if(!W(H))throw new TypeError;g=H}}return g}function Ue(c,d,u){var g=Me(c,d,u);if(g)return!0;var T=Ge(d);return gt(T)?!1:Ue(c,T,u)}function Me(c,d,u){var g=le(d,u,!1);return M(g)?!1:bi(g.OrdinaryHasOwnMetadata(c,d,u))}function re(c,d,u){var g=Me(c,d,u);if(g)return se(c,d,u);var T=Ge(d);if(!gt(T))return re(c,T,u)}function se(c,d,u){var g=le(d,u,!1);if(!M(g))return g.OrdinaryGetOwnMetadata(c,d,u)}function ne(c,d,u,g){var T=le(u,g,!0);T.OrdinaryDefineOwnMetadata(c,d,u,g)}function ae(c,d){var u=oe(c,d),g=Ge(c);if(g===null)return u;var T=ae(g,d);if(T.length<=0)return u;if(u.length<=0)return T;for(var U=new N,H=[],P=0,v=u;P<v.length;P++){var _=v[P],b=U.has(_);b||(U.add(_),H.push(_))}for(var w=0,A=T;w<A.length;w++){var _=A[w],b=U.has(_);b||(U.add(_),H.push(_))}return H}function oe(c,d){var u=le(c,d,!1);return u?u.OrdinaryOwnMetadataKeys(c,d):[]}function ce(c){if(c===null)return 1;switch(typeof c){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return c===null?1:6;default:return 6}}function M(c){return c===void 0}function gt(c){return c===null}function Te(c){return typeof c=="symbol"}function W(c){return typeof c=="object"?c!==null:typeof c=="function"}function dr(c,d){switch(ce(c)){case 0:return c;case 1:return c;case 2:return c;case 3:return c;case 4:return c;case 5:return c}var u="string",g=Ei(c,h);if(g!==void 0){var T=g.call(c,u);if(W(T))throw new TypeError;return T}return ur(c)}function ur(c,d){var u,g,T;{var U=c.toString;if(Ce(U)){var g=U.call(c);if(!W(g))return g}var u=c.valueOf;if(Ce(u)){var g=u.call(c);if(!W(g))return g}}throw new TypeError}function bi(c){return!!c}function fr(c){return""+c}function mt(c){var d=dr(c);return Te(d)?d:fr(d)}function wi(c){return Array.isArray?Array.isArray(c):c instanceof Object?c instanceof Array:Object.prototype.toString.call(c)==="[object Array]"}function Ce(c){return typeof c=="function"}function xi(c){return typeof c=="function"}function gr(c){switch(ce(c)){case 3:return!0;case 4:return!0;default:return!1}}function ze(c,d){return c===d||c!==c&&d!==d}function Ei(c,d){var u=c[d];if(u!=null){if(!Ce(u))throw new TypeError;return u}}function Mi(c){var d=Ei(c,f);if(!Ce(d))throw new TypeError;var u=d.call(c);if(!W(u))throw new TypeError;return u}function Ti(c){return c.value}function Ci(c){var d=c.next();return d.done?!1:d}function Si(c){var d=c.return;d&&d.call(c)}function Ge(c){var d=Object.getPrototypeOf(c);if(typeof c!="function"||c===I||d!==I)return d;var u=c.prototype,g=u&&Object.getPrototypeOf(u);if(g==null||g===Object.prototype)return d;var T=g.constructor;return typeof T!="function"||T===c?d:T}function mr(){var c;!M(G)&&typeof i.Reflect<"u"&&!(G in i.Reflect)&&typeof i.Reflect.defineMetadata=="function"&&(c=_r(i.Reflect));var d,u,g,T=new it,U={registerProvider:H,getProvider:v,setProvider:b};return U;function H(w){if(!Object.isExtensible(U))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case c===w:break;case M(d):d=w;break;case d===w:break;case M(u):u=w;break;case u===w:break;default:g===void 0&&(g=new N),g.add(w);break}}function P(w,A){if(!M(d)){if(d.isProviderFor(w,A))return d;if(!M(u)){if(u.isProviderFor(w,A))return d;if(!M(g))for(var B=Mi(g);;){var z=Ci(B);if(!z)return;var dt=Ti(z);if(dt.isProviderFor(w,A))return Si(B),dt}}}if(!M(c)&&c.isProviderFor(w,A))return c}function v(w,A){var B=T.get(w),z;return M(B)||(z=B.get(A)),M(z)&&(z=P(w,A),M(z)||(M(B)&&(B=new R,T.set(w,B)),B.set(A,z))),z}function _(w){if(M(w))throw new TypeError;return d===w||u===w||!M(g)&&g.has(w)}function b(w,A,B){if(!_(B))throw new Error("Metadata provider not registered.");var z=v(w,A);if(z!==B){if(!M(z))return!1;var dt=T.get(w);M(dt)&&(dt=new R,T.set(w,dt)),dt.set(A,B)}return!0}}function pr(){var c;return!M(G)&&W(i.Reflect)&&Object.isExtensible(i.Reflect)&&(c=i.Reflect[G]),M(c)&&(c=mr()),!M(G)&&W(i.Reflect)&&Object.isExtensible(i.Reflect)&&Object.defineProperty(i.Reflect,G,{enumerable:!1,configurable:!1,writable:!1,value:c}),c}function vr(c){var d=new it,u={isProviderFor:function(_,b){var w=d.get(_);return M(w)?!1:w.has(b)},OrdinaryDefineOwnMetadata:H,OrdinaryHasOwnMetadata:T,OrdinaryGetOwnMetadata:U,OrdinaryOwnMetadataKeys:P,OrdinaryDeleteMetadata:v};return D.registerProvider(u),u;function g(_,b,w){var A=d.get(_),B=!1;if(M(A)){if(!w)return;A=new R,d.set(_,A),B=!0}var z=A.get(b);if(M(z)){if(!w)return;if(z=new R,A.set(b,z),!c.setProvider(_,b,u))throw A.delete(b),B&&d.delete(_),new Error("Wrong provider for target.")}return z}function T(_,b,w){var A=g(b,w,!1);return M(A)?!1:bi(A.has(_))}function U(_,b,w){var A=g(b,w,!1);if(!M(A))return A.get(_)}function H(_,b,w,A){var B=g(w,A,!0);B.set(_,b)}function P(_,b){var w=[],A=g(_,b,!1);if(M(A))return w;for(var B=A.keys(),z=Mi(B),dt=0;;){var Ri=Ci(z);if(!Ri)return w.length=dt,w;var xr=Ti(Ri);try{w[dt]=xr}catch(Er){try{Si(z)}finally{throw Er}}dt++}}function v(_,b,w){var A=g(b,w,!1);if(M(A)||!A.delete(_))return!1;if(A.size===0){var B=d.get(b);M(B)||(B.delete(w),B.size===0&&d.delete(B))}return!0}}function _r(c){var d=c.defineMetadata,u=c.hasOwnMetadata,g=c.getOwnMetadata,T=c.getOwnMetadataKeys,U=c.deleteMetadata,H=new it,P={isProviderFor:function(v,_){var b=H.get(v);return!M(b)&&b.has(_)?!0:T(v,_).length?(M(b)&&(b=new N,H.set(v,b)),b.add(_),!0):!1},OrdinaryDefineOwnMetadata:d,OrdinaryHasOwnMetadata:u,OrdinaryGetOwnMetadata:g,OrdinaryOwnMetadataKeys:T,OrdinaryDeleteMetadata:U};return P}function le(c,d,u){var g=D.getProvider(c,d);if(!M(g))return g;if(u){if(D.setProvider(c,d,rt))return rt;throw new Error("Illegal state.")}}function yr(){var c={},d=[],u=function(){function P(v,_,b){this._index=0,this._keys=v,this._values=_,this._selector=b}return P.prototype["@@iterator"]=function(){return this},P.prototype[f]=function(){return this},P.prototype.next=function(){var v=this._index;if(v>=0&&v<this._keys.length){var _=this._selector(this._keys[v],this._values[v]);return v+1>=this._keys.length?(this._index=-1,this._keys=d,this._values=d):this._index++,{value:_,done:!1}}return{value:void 0,done:!0}},P.prototype.throw=function(v){throw this._index>=0&&(this._index=-1,this._keys=d,this._values=d),v},P.prototype.return=function(v){return this._index>=0&&(this._index=-1,this._keys=d,this._values=d),{value:v,done:!0}},P}(),g=function(){function P(){this._keys=[],this._values=[],this._cacheKey=c,this._cacheIndex=-2}return Object.defineProperty(P.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),P.prototype.has=function(v){return this._find(v,!1)>=0},P.prototype.get=function(v){var _=this._find(v,!1);return _>=0?this._values[_]:void 0},P.prototype.set=function(v,_){var b=this._find(v,!0);return this._values[b]=_,this},P.prototype.delete=function(v){var _=this._find(v,!1);if(_>=0){for(var b=this._keys.length,w=_+1;w<b;w++)this._keys[w-1]=this._keys[w],this._values[w-1]=this._values[w];return this._keys.length--,this._values.length--,ze(v,this._cacheKey)&&(this._cacheKey=c,this._cacheIndex=-2),!0}return!1},P.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=c,this._cacheIndex=-2},P.prototype.keys=function(){return new u(this._keys,this._values,T)},P.prototype.values=function(){return new u(this._keys,this._values,U)},P.prototype.entries=function(){return new u(this._keys,this._values,H)},P.prototype["@@iterator"]=function(){return this.entries()},P.prototype[f]=function(){return this.entries()},P.prototype._find=function(v,_){if(!ze(this._cacheKey,v)){this._cacheIndex=-1;for(var b=0;b<this._keys.length;b++)if(ze(this._keys[b],v)){this._cacheIndex=b;break}}return this._cacheIndex<0&&_&&(this._cacheIndex=this._keys.length,this._keys.push(v),this._values.push(void 0)),this._cacheIndex},P}();return g;function T(P,v){return P}function U(P,v){return v}function H(P,v){return[P,v]}}function br(){var c=function(){function d(){this._map=new R}return Object.defineProperty(d.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),d.prototype.has=function(u){return this._map.has(u)},d.prototype.add=function(u){return this._map.set(u,u),this},d.prototype.delete=function(u){return this._map.delete(u)},d.prototype.clear=function(){this._map.clear()},d.prototype.keys=function(){return this._map.keys()},d.prototype.values=function(){return this._map.keys()},d.prototype.entries=function(){return this._map.entries()},d.prototype["@@iterator"]=function(){return this.keys()},d.prototype[f]=function(){return this.keys()},d}();return c}function wr(){var c=16,d=C.create(),u=g();return function(){function v(){this._key=g()}return v.prototype.has=function(_){var b=T(_,!1);return b!==void 0?C.has(b,this._key):!1},v.prototype.get=function(_){var b=T(_,!1);return b!==void 0?C.get(b,this._key):void 0},v.prototype.set=function(_,b){var w=T(_,!0);return w[this._key]=b,this},v.prototype.delete=function(_){var b=T(_,!1);return b!==void 0?delete b[this._key]:!1},v.prototype.clear=function(){this._key=g()},v}();function g(){var v;do v="@@WeakMap@@"+P();while(C.has(d,v));return d[v]=!0,v}function T(v,_){if(!r.call(v,u)){if(!_)return;Object.defineProperty(v,u,{value:C.create()})}return v[u]}function U(v,_){for(var b=0;b<_;++b)v[b]=Math.random()*255|0;return v}function H(v){if(typeof Uint8Array=="function"){var _=new Uint8Array(v);return typeof crypto<"u"?crypto.getRandomValues(_):typeof msCrypto<"u"?msCrypto.getRandomValues(_):U(_,v),_}return U(new Array(v),v)}function P(){var v=H(c);v[6]=v[6]&79|64,v[8]=v[8]&191|128;for(var _="",b=0;b<c;++b){var w=v[b];(b===4||b===6||b===8)&&(_+="-"),w<16&&(_+="0"),_+=w.toString(16).toLowerCase()}return _}}function We(c){return c.__=void 0,delete c.__,c}})}(n||(n={})),Ai}Lr();const fi=Symbol("editor");function E(n){return Reflect.metadata(fi,(...t)=>new n(...t))}function Yi(n){return Reflect.metadata(fi,n)}function $i(n,t,e){const i=Reflect.getMetadata(fi,t,e);if(i!==void 0)return i(n,t,e,t[e])}const Ir=500;class ht{constructor(t,e,i,r){a(this,"id");this.editorWindow=t,this.target=e,this.name=i,this.value=r,this.editorWindow.addEventListener(li,this.startUpdate.bind(this)),this.editorWindow.addEventListener(Gi,this.startUpdate.bind(this)),this.editorWindow.addEventListener(hi,this.stopUpdate.bind(this)),this.editorWindow.addEventListener(zi,this.stopUpdate.bind(this))}static initWindow(t,e){const i=V("#"+e);return l(i)?i:(t.id=e,t.addEventListener("keydown",r=>r.stopPropagation()),t.addEventListener("keyup",r=>r.stopPropagation()),t.addEventListener("keypress",r=>r.stopPropagation()),t.addEventListener("pointerdown",()=>{const r=Array.from(oi(t.parentElement).children);if(t.style.zIndex!==String(r.length+1)){r.sort((s,h)=>Number(s.style.zIndex)-Number(h.style.zIndex));for(let s=0;s<r.length;s++)r[s].style.zIndex=String(s+1);t.style.zIndex=String(r.length+1)}}),t)}startUpdate(){l(this.id)||(this.id=setInterval(this.update.bind(this),Ir))}update(){}stopUpdate(){l(this.id)&&clearInterval(this.id)}readValue(){return this.target[this.name]}saveValue(t){const e=this.target,i=e[this.name];e[this.name]=t,typeof e.onPropertyChange=="function"&&e.onPropertyChange(this.name,i,t)}getLabel(){const t=this.name.startsWith("_")?this.name.substring(1):this.name;return t[0].toUpperCase()+t.substring(1)}container(t){return x.div("editor-container",t)}}const Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",Li=new Set;function Ii(n,t){return Math.random()*(Math.max(n,t)-Math.min(n,t))+n}function Zt(n=!1,t=8){let e,r=0;do{do e="",e+=Se[Math.floor(Ii(0,Se.length))];while(n&&!/^[a-zA-Z]$/.test(e));for(let s=0;s<t-1;s++)e+=Se[Math.floor(Ii(0,Se.length))];if(++r===1e4)break}while(Li.has(e));return r===1e4?Zt(n,t+1):(Li.add(e),e)}class Jt extends ht{constructor(){super(...arguments);a(this,"input");a(this,"inputFocused",!1)}static enableNumberScrolling(e,i,r=.1){let s=!1;e.addEventListener("pointerdown",async h=>{s=!0,e.setPointerCapture(h.pointerId)}),e.addEventListener("pointerup",h=>{s=!1,e.releasePointerCapture(h.pointerId)}),e.addEventListener("pointermove",h=>{s&&(i.value=String(Number(i.value)+h.movementX*r),i.dispatchEvent(new Event("input")))})}getType(){return"text"}update(){!l(this.input)||this.inputFocused||(this.input.value=String(this.readValue()))}html(){const e=Zt(!0),i=x.input({type:this.getType(),id:e,value:String(this.value),onInput:()=>this.saveValue(this.parseValue(i.value)),onFocus:()=>{this.inputFocused=!0},onBlur:()=>{this.inputFocused=!1}});this.input=i;const r=x.label({for:e},this.getLabel());i.type==="number"&&Jt.enableNumberScrolling(r,i);const s=this.container([r,i]);return s.classList.add("type-"+this.getType()),s}}class Qt extends ht{constructor(){super(...arguments);a(this,"x");a(this,"y");a(this,"z")}createCombo(e,i){const r=Zt(!0);i.id=r;const s=x.label({for:r},e);return Jt.enableNumberScrolling(s,i),x.div(tt,[s,i])}saveVector(){this.saveValue(glm.vec3(Number(this.x.value),Number(this.y.value),Number(this.z.value)))}update(){const e=this.readValue();this.x.value=String(e.x),this.y.value=String(e.y),this.z.value=String(e.z)}html(){return this.x=x.input({type:"number",value:this.value.x,onInput:()=>this.saveVector()}),this.y=x.input({type:"number",value:this.value.y,onInput:()=>this.saveVector()}),this.z=x.input({type:"number",value:this.value.z,onInput:()=>this.saveVector()}),this.container([x.span(tt,this.getLabel()),x.div("vec3",[this.createCombo("X",this.x),this.createCombo("Y",this.y),this.createCombo("Z",this.z)])])}}class Q{static fromEuler(t,e,i){return glm.quat(glm.vec3(t,e,i))}static toEuler(t){const{x:e,y:i,z:r,w:s}=t,h=2*(s*e+i*r),f=1-2*(e*e+i*i),m=Math.atan2(h,f);let p=2*(s*i-r*e);p>1&&(p=1),p<-1&&(p=-1);const S=Math.asin(p),C=2*(s*r+e*i),I=1-2*(i*i+r*r),R=Math.atan2(C,I);return glm.vec3(F.round(m,5),F.round(S,5),F.round(R,5))}static toEulerDegrees(t){const e=Q.toEuler(t);return e["*="](180/Math.PI),e}static fromEulerDegrees(t,e,i){return glm.quat(glm.vec3(glm.radians(t),glm.radians(e),glm.radians(i)))}}class Xe extends Qt{constructor(){super(...arguments);a(this,"getter",()=>glm.vec3(0,0,0));a(this,"setter",()=>glm.vec3(0,0,0))}setGetter(e){this.getter=e}setSetter(e){this.setter=e}readValue(){return this.getter()}saveValue(e){this.setter(e)}}class Dr extends ht{constructor(){super(...arguments);a(this,"position");a(this,"rotation");a(this,"scale")}update(){var e,i;(e=this.position)==null||e.update(),(i=this.scale)==null||i.update()}html(){const e=new Xe(this.editorWindow,this.value,"position",this.value.getPosition());e.setGetter(()=>this.value.getPosition()),e.setSetter(s=>this.value.setPosition(s)),this.position=e;const i=new Xe(this.editorWindow,this.value,"rotation",Q.toEulerDegrees(this.value.getRotation()));i.setGetter(()=>Q.toEulerDegrees(this.value.getRotation())),i.setSetter(s=>this.value.setRotation(Q.fromEulerDegrees(s.x,s.y,s.z))),this.rotation=i;const r=new Xe(this.editorWindow,this.value,"scale",this.value.getScale());return r.setGetter(()=>this.value.getScale()),r.setSetter(s=>this.value.setScale(s)),this.scale=r,x.div("editor-column",[e.html(),i.html(),r.html()])}}class qi{constructor(t,e){this.parentMatrix=t,this.camera=e}}const De=class De{constructor(t,e=void 0,i=void 0){a(this,"_id");a(this,"isActive");a(this,"components");a(this,"_transform");a(this,"renderer");a(this,"_scene");this._name=t,this._id=De.counter.increment(),this.isActive=!0,this.components=new Map,this._transform=l(e)?e:new Pr,this._transform.bind(this),this._scene=i??q,this._scene.addGameObject(this)}update(){if(this.isActive)for(const t of this.components.values())t.isEnabled()&&t.update()}fixedUpdate(){if(this.isActive)for(const t of this.components.values())t.isEnabled()&&t.fixedUpdate()}render(t){var r,s,h;if(!this.isActive||this===t.camera.gameObject)return;((r=this.renderer)==null?void 0:r.isEnabled())===!0&&((s=this.renderer)==null||s.draw(t));const e=this.transform.getChildren();if(e.length===0)return;const i=new qi(t.parentMatrix["*"](this.transform.getMatrix()),t.camera);for(const f of e)(h=f.gameObject)==null||h.render(i)}delete(){this.setActive(!1);for(const t of this.components.values())t.delete();this.removeFromScene()}removeFromScene(){this._scene.deleteGameObject(t=>t._id===this._id)}getId(){return this._name+"-"+this._id}setActive(t){this.isActive=t}get transform(){return this._transform}get name(){return this._name}getScene(){return this._scene}addComponent(t){const e=new t;return Ar(e)&&(this.renderer=e),e.bind(this),this.components.set(t.name,e),e.awake(),e}getComponent(t){return this.components.get(t.name)}hasComponent(t){return this.components.has(t.name)}getComponents(){return this.components}findComponent(t){for(const e of this.components.values())if(t(e))return e;return null}getEditorWindow(){const t=this.getId(),e=V("#"+t);if(l(e))return e;const i=x.div("editor-content"),r=pe(this.name,i,{isDraggable:!0,isMinimizable:!0,width:"400px"});i.append(new Dr(r,this,"transform",this.transform).html());for(const[s,h]of this.components){const f=x.div("component-content");for(const m of Object.keys(h)){const p=$i(r,h,m);l(p)&&f.append(p.html())}i.append(x.div("component",[x.h3(tt,s),f]))}return ht.initWindow(r,t)}};a(De,"counter",new ci);let fe=De;class It extends ht{html(){const t=Zt(!0),e=x.input({type:"checkbox",id:t,checked:this.value});e.addEventListener("input",()=>{this.saveValue(!!e.checked)});const i=this.container([x.label({for:t},this.getLabel()),e]);return i.classList.add("type-checkbox"),i}}var Fr=Object.defineProperty,kr=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&Fr(t,e,r),r};class K{constructor(){a(this,"_gameObject");a(this,"enable",!0)}setEnable(t){this.enable=t}isEnabled(){return this.enable}bind(t){this._gameObject=t}get gameObject(){return this._gameObject}get transform(){return this.gameObject.transform}get scene(){return this.gameObject.getScene()}awake(){}update(){}fixedUpdate(){}delete(){}onPropertyChange(t,e,i){}}kr([E(It)],K.prototype,"enable");class Ki{constructor(t,e){a(this,"cache");this.toKey=t,this.builder=e,this.cache=new Map}get(t){const e=this.toKey(t),i=this.cache.get(e);if(l(i))return i;const r=this.builder(t);return this.cache.set(e,r),r}}const Vr=new Uint8Array([0,0,0,0]),$t=class $t{constructor(t){a(this,"loaded");a(this,"deleted");a(this,"references",0);this.glTexture=t,this.loaded=!1,this.deleted=!1}static create(t){o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!0);const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,1,1,0,o.RGBA,o.UNSIGNED_BYTE,Vr);const i=new $t(e),r=new Image;return r.onerror=console.log,r.onload=()=>{if(i.markLoaded(),o.bindTexture(o.TEXTURE_2D,e),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,r),F.is2PowX(r.width)&&F.is2PowX(r.height)){o.generateMipmap(o.TEXTURE_2D);return}o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR)},r.src=t,i}static load(t){const e=$t.textures.get(t);return e.references++,e}static bind(t,e,i,r=0){if(!l(t)||!t.loaded||t.deleted){o.activeTexture(o.TEXTURE0+r),o.bindTexture(o.TEXTURE_2D,null),e.setInt(i,0);return}o.activeTexture(o.TEXTURE0+r),o.bindTexture(o.TEXTURE_2D,t.glTexture),e.setInt(i,r)}markLoaded(){this.loaded=!0}delete(){this.references--,!(this.references>0)&&(this.deleted||(o.deleteTexture(this.glTexture),this.deleted=!0))}};a($t,"textures",new Ki(t=>t,$t.create));let $=$t;const Z=class Z{constructor(t){a(this,"bindCallback");a(this,"unbindCallback");a(this,"uniforms");a(this,"currentMaterial");this.program=t,this.uniforms=new Map,this.bindCallback=()=>{},this.unbindCallback=()=>{}}static create(t){const e=Z.compile(o.VERTEX_SHADER,t.getVertexCode());if(!l(e))throw new Error("Shader compilation error");const i=Z.compile(o.FRAGMENT_SHADER,t.getFragmentCode());if(!l(i))throw new Error("Shader compilation error");const r=Z.link(e,i);if(o.deleteShader(i),o.deleteShader(e),!l(r))throw new Error("Shader program compilation error");return new Z(r)}static load(t){return Z.shaders.get(t)}static getShaderTypeName(t){switch(t){case o.VERTEX_SHADER:return"Vertex";case o.FRAGMENT_SHADER:return"Fragment";default:return"Unknown"}}static getCompilationStatus(t){const e=o.getShaderParameter(t,o.COMPILE_STATUS),i=o.getShaderParameter(t,o.SHADER_TYPE),r=o.getShaderInfoLog(t);if(!l(r)||r.length===0)return!0;const s=this.getShaderTypeName(i);return e===!0?(console.warn(s+" compilation warning: "+r),!0):(console.error(s+" compilation error: "+r),!1)}static compile(t,e){const i=o.createShader(t);if(!l(i))throw new Error("Could not create new GL shader");return o.shaderSource(i,e),o.compileShader(i),Z.getCompilationStatus(i)?i:(o.deleteShader(i),null)}static getLinkStatus(t){return o.validateProgram(t),o.getProgramParameter(t,o.VALIDATE_STATUS)==!0?!0:(console.error("Shader linking error: {}",o.getProgramInfoLog(t)??""),!1)}static link(t,e){const i=o.createProgram();return o.attachShader(i,t),o.attachShader(i,e),o.linkProgram(i),this.getLinkStatus(i)?i:(o.deleteProgram(i),null)}onBind(t){return this.bindCallback=t,this}onUnbind(t){return this.unbindCallback=t,this}bind(){return this===Z.currentlyBound?!1:(l(Z.currentlyBound)&&Z.currentlyBound.unbindCallback(Z.currentlyBound),Z.currentlyBound=this,o.useProgram(this.program),this.bindCallback(this),!0)}getProgram(){return this.program}setUniformBlockBinding(t,e){const i=o.getUniformBlockIndex(this.program,t);o.uniformBlockBinding(this.program,i,e)}getUniformLocation(t){const e=this.uniforms.get(t);if(l(e))return e;if(e===null)return null;const i=o.getUniformLocation(this.program,t);return this.uniforms.set(t,i),i}setFloat(t,e){o.uniform1f(this.getUniformLocation(t),e)}setInt(t,e){o.uniform1i(this.getUniformLocation(t),e)}setVec3(t,e){o.uniform3f(this.getUniformLocation(t),e.x,e.y,e.z)}setVec2(t,e){o.uniform2f(this.getUniformLocation(t),e.x,e.y)}setMat4(t,e,i=!1){o.uniformMatrix4fv(this.getUniformLocation(t),i,e.elements)}setMaterialPhong(t,e){this.currentMaterial!==e.name&&(this.setVec3(t+".ambient",e.ambient),this.setVec3(t+".diffuse",e.diffuse),this.setVec3(t+".specular",e.specular),this.setVec2(t+".textureOffset",e.textureOffset),this.setFloat(t+".shininess",e.shininess),this.setInt(t+".maps",e.maps),$.bind(e.map_ambient,this,t+"_ambient",0),$.bind(e.map_diffuse,this,t+"_diffuse",1),$.bind(e.map_specular,this,t+"_specular",2),$.bind(e.map_shininess,this,t+"_shininess",3),$.bind(e.map_bump,this,t+"_bump",4),this.currentMaterial=e.name)}setMaterialPbr(t,e){this.currentMaterial!==e.name&&(this.setFloat(t+".ao",1),this.setVec3(t+".albedo",e.diffuse),this.setVec2(t+".textureOffset",e.textureOffset),this.setFloat(t+".metallic",e.metallic),this.setFloat(t+".roughness",e.shininess),this.setInt(t+".maps",e.maps),$.bind(e.map_ambient,this,t+"_ao",0),$.bind(e.map_diffuse,this,t+"_albedo",1),$.bind(e.map_specular,this,t+"_metallic",2),$.bind(e.map_shininess,this,t+"_roughness",3),$.bind(e.map_bump,this,t+"_bump",4),this.currentMaterial=e.name)}};a(Z,"currentlyBound"),a(Z,"shaders",new Ki(t=>t.getName(),Z.create));let Lt=Z;class Zi{constructor(t,e,i,r){a(this,"total");this.vertexFloats=t,this.normalFloats=e,this.textureCoordFloats=i,this.materialIndexFloats=r,this.total=this.vertexFloats+this.normalFloats+this.textureCoordFloats+this.materialIndexFloats}getMaterialIndexFloats(){return this.materialIndexFloats}getVertexFloats(){return this.vertexFloats}getNormalFloats(){return this.normalFloats}getTextureCoordFloats(){return this.textureCoordFloats}getTotalFloats(){return this.total}}const Pt=4,Br=4,jr=4,Ji=64,ti=16,Nr=0,ei=ti*Pt*Ji,Ur=ei+Br,gi=3,zr=3,Gr=2,Pe=0,qt=new Zi(gi,Pe,Pe,Pe),j=new Zi(gi,zr,Gr,Pe);function ii(n){l(n)&&o.deleteBuffer(n)}function Qi(n){l(n)&&o.deleteVertexArray(n)}const Wr=1,Hr=2,Xr=4,Yr=8,$r=16;class tr{constructor(t){a(this,"name");a(this,"ambient");a(this,"diffuse");a(this,"specular");a(this,"textureOffset");a(this,"shininess");a(this,"metallic");a(this,"maps");a(this,"map_ambient");a(this,"map_diffuse");a(this,"map_specular");a(this,"map_shininess");a(this,"map_bump");const e=t.getData();this.name=e.name,this.ambient=glm.vec3(...e.ambient.slice(0,3)),this.diffuse=glm.vec3(...e.diffuse.slice(0,3)),this.specular=glm.vec3(...e.specular.slice(0,3)),this.textureOffset=glm.vec2(0,0),this.shininess=e.shininess,this.metallic=e.metallic,this.maps=0,l(e.map_ambient)&&(this.maps|=Wr,this.map_ambient=$.load(e.map_ambient)),l(e.map_diffuse)&&(this.maps|=Hr,this.map_diffuse=$.load(e.map_diffuse)),l(e.map_specular)&&(this.maps|=Xr,this.map_specular=$.load(e.map_specular)),l(e.map_shininess)&&(this.maps|=Yr,this.map_shininess=$.load(e.map_shininess)),l(e.map_bump)&&(this.maps|=$r,this.map_bump=$.load(e.map_bump))}delete(){var t,e,i,r,s;(t=this.map_ambient)==null||t.delete(),(e=this.map_diffuse)==null||e.delete(),(i=this.map_specular)==null||i.delete(),(r=this.map_shininess)==null||r.delete(),(s=this.map_bump)==null||s.delete()}}class qr{constructor(t){a(this,"vao");a(this,"vbo");a(this,"ebo");a(this,"hasEbo");a(this,"vertexCount");a(this,"material");a(this,"boundingBox");a(this,"name");this.name=t.getName(),this.boundingBox=t.getBoundingBox(),this.material=new tr(t.getMaterialSource());const e=t.getData(),i=t.getVertexLayout();this.vertexCount=t.hasIndexes()?t.getFaceCount()*3:Math.floor(e.length/i.getTotalFloats()),this.vao=o.createVertexArray(),o.bindVertexArray(this.vao),this.hasEbo=t.hasIndexes(),t.hasIndexes()&&(this.ebo=o.createBuffer(),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.ebo),o.bufferData(o.ELEMENT_ARRAY_BUFFER,t.getIndexes(),o.STATIC_DRAW)),this.vbo=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,this.vbo),o.bufferData(o.ARRAY_BUFFER,e,o.STATIC_DRAW);let r=0;const s=i.getTotalFloats()*Pt;o.enableVertexAttribArray(0),o.vertexAttribPointer(0,i.getVertexFloats(),o.FLOAT,!1,s,r*Pt),r+=i.getVertexFloats(),o.enableVertexAttribArray(1),o.vertexAttribPointer(1,i.getNormalFloats(),o.FLOAT,!1,s,r*Pt),r+=i.getNormalFloats(),o.enableVertexAttribArray(2),o.vertexAttribPointer(2,i.getTextureCoordFloats(),o.FLOAT,!1,s,r*Pt),o.bindVertexArray(null),o.bindBuffer(o.ARRAY_BUFFER,null),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null)}bind(){o.bindVertexArray(this.vao)}draw(){this.hasEbo?o.drawElements(o.TRIANGLES,this.vertexCount,o.UNSIGNED_INT,0):o.drawArrays(o.TRIANGLES,0,this.vertexCount)}delete(){o.deleteVertexArray(this.vao),o.deleteBuffer(this.vbo),this.material.delete()}getMaterial(){return this.material}getBoundingBox(){return this.boundingBox}setMaterial(t){this.material=t}}class O{constructor(t,e=void 0){a(this,"directory");this.literal=t,this.extension=e;const i=this.literal.split(".");i.length>=2&&!l(this.extension)&&(this.extension=i[i.length-1]);const r=this.literal.split("/");r.length>=2&&(this.directory=r.slice(0,r.length-1).join("/"))}static from(t){return new O(t)}static ltrim(t){for(let e=0;e<t.length;e++)if(!(t[e]==="/"||t[e]==="\\"))return t.substring(e);return""}static rtrim(t){for(let e=t.length-1;e>=0;e++)if(!(t[e]==="/"||t[e]==="\\"))return t.substring(0,e+1);return""}static join(...t){if(t=t.filter(s=>s!==""),t.length===0)return null;let e=t.length;if(e===1)return O.from(t[0]);const i=t.shift(),r=t.pop();if(e-=2,e===0)return O.from(O.rtrim(i)+"/"+O.ltrim(r));for(let s=0;s<e;s++)t[s]=O.ltrim(O.rtrim(t[s]));return O.from(O.rtrim(i)+"/"+t.join("/")+"/"+O.ltrim(r))}getExtension(){return this.extension}getDirectory(){return this.directory}getLiteral(){return this.literal}async read(){const t=await fetch(this.literal);return l(t.headers.get("last-modified"))?await t.text():tt}}class er{constructor(t){a(this,"collection");a(this,"current");a(this,"currentUpdated");this.factory=t,this.collection=[],this.current=this.factory(),this.currentUpdated=!1}set(t,e,i=!0){this.currentUpdated=i,this.current[t]=e}save(t=void 0){this.currentUpdated&&(this.collection.push(this.current),this.current=t??this.factory(),this.currentUpdated=!1)}getCollection(){return this.collection}getCurrent(){return this.current}markAsUpdated(){this.currentUpdated=!0}}class k{static mutateMap(t,e){const i=t;for(let r=0;r<t.length;r++)i[r]=e(t[r]);return i}static writeVec3(t,e,i){return t[e++]=i.x,t[e++]=i.y,t[e++]=i.z,e}static writeVec2(t,e,i){return t[e++]=i.x,t[e++]=i.y,e}}class Kr{async parse(t){const e=await t.read();if(!l(e))return tt;const i=new er(()=>({name:"",path:t.getLiteral()}));let r=0;for(;;){const s=e.indexOf(`
`,r+1);let h=s===-1?e.substring(r).trim():e.substring(r,s).trim();if(h===""||h[0]==="#"||this.processLine(h,i),s===-1)break;r=s}return i.save(),i.getCollection()}processLine(t,e){const i=t.indexOf("#");i!==-1&&(t=t.substring(0,i).trim());const r=t.split(" "),s=r.shift();if(l(s)){if(s.startsWith("map_")){e.set(s,r[0]);return}switch(s){case"Ka":case"Kd":case"Ks":case"Ke":case"Tf":e.set(s,k.mutateMap(r,parseFloat));break;case"d":case"Tr":case"Ns":case"Ni":e.set(s,parseFloat(r[0]??0));break;case"newmtl":e.save(),e.set("name",r[0]??"");break;case"illum":e.set("illum",Math.round(Number(r[0]??0)));break}}}}class Zr{constructor(){a(this,"vertexToIndex");a(this,"indexes");this.vertexToIndex=new Map,this.indexes=[]}lookupVertex(t){const e=this.vertexToIndex.get(t);if(l(e))return e;const i=this.vertexToIndex.size;return this.vertexToIndex.set(t,i),i}addVertexIndex(t){this.indexes.push(t)}getIndexes(){return this.indexes}getVertexToIndex(){return this.vertexToIndex}}const Fe=class Fe{constructor(){a(this,"vertexes",[]);a(this,"normals",[]);a(this,"textureCoords",[]);a(this,"materials",[]);a(this,"currentMaterial","")}async parse(t,e){this.vertexes=[],this.normals=[],this.textureCoords=[],this.materials=[];let i=0;const r=new er(()=>({name:"",parts:new Map}));for(;;){const s=e.indexOf(`
`,i+1),h=s===-1?e.substring(i).trim():e.substring(i,s).trim();if(h===""||h[0]==="#"||await this.processLine(h,r,t),s===-1)break;i=s}return r.save(),{vertexes:this.vertexes,normals:this.normals,textureCoords:this.textureCoords,materials:this.materials,models:r.getCollection()}}async processLine(t,e,i){const r=t.indexOf("#");r!==-1&&(t=t.substring(0,r).trim());const s=t.split(" "),h=s.shift();if(!l(h))return;const f=e.getCurrent();switch(h){case"v":this.vertexes.push(k.mutateMap(s,parseFloat));break;case"vn":this.normals.push(k.mutateMap(s,parseFloat));break;case"vt":this.textureCoords.push(k.mutateMap(s,parseFloat));break;case"f":e.markAsUpdated();const m=f.parts.get(this.currentMaterial)??new Zr,p=m.lookupVertex(s[0]);for(let I=0;I<s.length-2;I++)m.addVertexIndex(p),m.addVertexIndex(m.lookupVertex(s[I+1])),m.addVertexIndex(m.lookupVertex(s[I+2]));f.parts.set(this.currentMaterial,m);break;case"usemtl":this.currentMaterial=s[0]??"";break;case"o":e.save(),e.set("name",s[0]??"",!1);break;case"mtllib":const S=O.join(i.getDirectory()??"/models",s[0]??"");if(!l(S))break;const C=await Fe.mtlParser.parse(S);if(!l(C))break;this.materials=this.materials.concat(C);break}}};a(Fe,"mtlParser",new Kr);let ri=Fe;class mi{constructor(t,e){a(this,"cache");this.toKey=t,this.builder=e,this.cache=new Map}async get(t){const e=this.toKey(t),i=this.cache.get(e);if(l(i))return i;const r=this.builder(t);return this.cache.set(e,await r),r}}const J=class J{constructor(t){this.data=t}static async create(t){const e=await t.read();if(!l(e))return tt;const i=JSON.parse(e);return i.name=t.getLiteral(),i.metallic=i.ambient.reduce((r,s)=>r+s,0)/i.ambient.length,new J(i)}static async load(t){return J.cache.get(t)}static async loadImage(t,e=void 0){if(e??(e=await J.create(J.getDefaultMaterial())),!!l(e))return e.data.name+=t,e.data.map_diffuse=t,e}static async loadImagePath(t,e=void 0){if(e??(e=await J.create(J.getDefaultMaterial())),!!l(e))return e.data.map_diffuse=t.getLiteral(),e}static getDefaultMaterial(){return O.from("/assets/materials/plastic-white.json")}static setMap(t,e,i,r){l(r)&&(t[e]=oi(O.join(i,r)).getLiteral())}static fromMtl(t){const e=t.Ka,i=t.Kd;if(l(t.Ke)){const h=t.Ke;e[0]+=h[0],e[1]+=h[1],e[2]+=h[2],e[0]*=i[0],e[1]*=i[1],e[2]*=i[2]}const r={name:t.path+"/"+t.name,ambient:e,diffuse:i,metallic:e[0],specular:t.Ks,shininess:(t.Ns??250)/1e3},s=O.from(t.path).getDirectory()??"/assets";return J.setMap(r,"map_ambient",s,t.map_Ka),J.setMap(r,"map_diffuse",s,t.map_Kd),J.setMap(r,"map_specular",s,t.map_Ks),J.setMap(r,"map_shininess",s,t.map_Ns),J.setMap(r,"map_bump",s,t.map_bump),new J(r)}getData(){return this.data}};a(J,"cache",new mi(t=>t.getLiteral(),J.create));let Vt=J;const ge=class ge{constructor(t,e){this.low=t,this.high=e}static getIndexType(){return o.UNSIGNED_SHORT}static initial(){return new ge(y.clone(y.MAX),y.clone(y.MIN))}add(t){this.addVertex(t.x,t.y,t.z)}addVertex(t,e,i){this.low.x>t&&(this.low.x=t),this.low.y>e&&(this.low.y=e),this.low.z>i&&(this.low.z=i),this.high.x<t&&(this.high.x=t),this.high.y<e&&(this.high.y=e),this.high.z<i&&(this.high.z=i)}getLow(){return this.low}getHigh(){return this.high}merge(t){this.low=y.min(this.low,t.low),this.high=y.max(this.high,t.high)}getVertexes(){const t=new Float32Array(8*gi);let e=0;return t[e++]=this.low.x,t[e++]=this.low.y,t[e++]=this.low.z,t[e++]=this.high.x,t[e++]=this.low.y,t[e++]=this.low.z,t[e++]=this.low.x,t[e++]=this.low.y,t[e++]=this.high.z,t[e++]=this.high.x,t[e++]=this.low.y,t[e++]=this.high.z,t[e++]=this.low.x,t[e++]=this.high.y,t[e++]=this.low.z,t[e++]=this.high.x,t[e++]=this.high.y,t[e++]=this.low.z,t[e++]=this.low.x,t[e++]=this.high.y,t[e++]=this.high.z,t[e++]=this.high.x,t[e++]=this.high.y,t[e++]=this.high.z,t}getVertexIndexes(){const t=new Uint16Array(ge.LINE_COUNT);let e=0;return t[e++]=0,t[e++]=1,t[e++]=0,t[e++]=2,t[e++]=1,t[e++]=3,t[e++]=2,t[e++]=3,t[e++]=4,t[e++]=5,t[e++]=4,t[e++]=6,t[e++]=5,t[e++]=7,t[e++]=6,t[e++]=7,t[e++]=0,t[e++]=4,t[e++]=1,t[e++]=5,t[e++]=2,t[e++]=6,t[e++]=3,t[e++]=7,t}};a(ge,"LINE_COUNT",12*2);let bt=ge;const Ye=[0,0,0];class Jr{async parse(t,e){const i=await new ri().parse(t,e),r=[],s=await Vt.load(Vt.getDefaultMaterial());if(!l(s))return[];const h=new Map;h.set("",s);for(const f of i.materials)h.set(f.name,Vt.fromMtl(f));for(let f=0;f<i.models.length;f++){const m=i.models[f];for(const[p,S]of m.parts){if(S.getIndexes().length===0)continue;const C=Uint32Array.from(S.getIndexes()),I=bt.initial(),R=new Float32Array(S.getVertexToIndex().size*j.getTotalFloats());for(const[N,it]of S.getVertexToIndex()){const G=N.split("/");let D=it*j.getTotalFloats();const rt=Number(G[0]),ct=rt>0?i.vertexes[rt-1]:Ye;R[D++]=ct[0],R[D++]=ct[1],R[D++]=ct[2],rt>0&&I.addVertex(ct[0],ct[1],ct[2]);const ft=Number(G[2]),nt=ft>0?i.normals[ft-1]:Ye;R[D++]=nt[0],R[D++]=nt[1],R[D++]=nt[2];const lt=Number(G[1]),et=lt>0?i.textureCoords[lt-1]:Ye;R[D++]=et[0],R[D++]=et[1]}r.push(new Nt(R,C.length/3,j,h.get(p)??s,I,m.name).setIndexes(C))}}return r}}const $e={obj:new Jr},me=class me{constructor(t,e,i,r,s,h=""){a(this,"indexes");this.data=t,this.faceCount=e,this.vertexLayout=i,this.materialSource=r,this.boundingBox=s,this.name=h}static isMeshFile(t){const e=t.getExtension();return l(e)?e in $e:!1}static async create(t){const e=t.getExtension();if(!l(e))throw new Error("Cannot infer type of the file without extension");if(!(e in $e))throw new Error(`The file extension ${e} is not supported`);const i=await t.read();return l(i)?await $e[e].parse(t,i):tt}static async load(t){return await me.cache.get(t)}hasIndexes(){return l(this.indexes)}setIndexes(t){return this.indexes=t,this}getIndexes(){return this.indexes}getName(){return this.name}getData(){return this.data}getFaceCount(){return this.faceCount}getVertexLayout(){return this.vertexLayout}getMaterialSource(){return this.materialSource}getBoundingBox(){return this.boundingBox}};a(me,"cache",new mi(t=>t.getLiteral(),me.create));let Nt=me;const Tt=class Tt{constructor(t,e,i){this.name=t,this.vertexCode=e,this.fragmentCode=i}static stringifyArg(t){return t.vertex.getLiteral()+t.fragment.getLiteral()}static async create(t){const e=await t.vertex.read(),i=await t.fragment.read();return!l(e)||!l(i)?tt:new Tt(Tt.stringifyArg(t),e,i)}static async load(t,e){return this.cache.get({vertex:t,fragment:e})}static async loadShader(t){return Tt.load(O.from("/assets/shaders/"+t+".vert"),O.from("/assets/shaders/"+t+".frag"))}getVertexCode(){return this.vertexCode}getFragmentCode(){return this.fragmentCode}getName(){return this.name}};a(Tt,"cache",new mi(Tt.stringifyArg,Tt.create));let Ut=Tt;class Y{constructor(t,e,i,r=255){this.r=t,this.g=e,this.b=i,this.a=r}static fromHex(t){if(t.startsWith("#")&&(t=t.substring(1)),t.length===6)return new Y(parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16));if(t.length===8)return new Y(parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16),parseInt(t.substring(6,8),16));throw new Error("Invalid hex format")}static vec3(t,e,i){return new Y(t*255,e*255,i*255)}static fromVec3(t){return new Y(t.x*255,t.y*255,t.z*255)}get red(){return this.r}set red(t){this.r=t}get green(){return this.g}set green(t){this.g=t}get blue(){return this.b}set blue(t){this.b=t}get alpha(){return this.a}set alpha(t){this.a=t}get vec3(){return glm.vec3(this.r/255,this.g/255,this.b/255)}get vec4(){return glm.vec4(this.r/255,this.g/255,this.b/255,this.a/255)}asHex(t=!1){const e=Math.floor(this.r).toString(16).padStart(2,"0"),i=Math.floor(this.g).toString(16).padStart(2,"0"),r=Math.floor(this.b).toString(16).padStart(2,"0"),s=Math.floor(this.a).toString(16).padStart(2,"0");return"#"+e+i+r+(t?s:"")}toString(){return this.asHex()}}class _e extends Jt{getType(){return"color"}parseValue(t){return Y.fromHex(t)}}var Qr=Object.defineProperty,ts=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&Qr(t,e,r),r};const es=Y.vec3(.5,1,.5);class Ve extends K{constructor(){super(...arguments);a(this,"_vao");a(this,"_vbo");a(this,"_ebo");a(this,"_shader");a(this,"color",es);a(this,"_boundingBox")}awake(){this._vao=o.createVertexArray(),o.bindVertexArray(this._vao),this._vbo=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,this._vbo),this._ebo=o.createBuffer(),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this._ebo),o.enableVertexAttribArray(0),o.vertexAttribPointer(0,qt.getVertexFloats(),o.FLOAT,!1,0,0),o.bindVertexArray(null),Ut.loadShader("ray").then(e=>{if(!l(e)){console.warn("Ray shader not found thus ray rendering is disabled");return}this._shader=Lt.load(e)})}delete(){Qi(this._vao),ii(this._vbo),ii(this._ebo)}draw(e){if(!l(this._vao)||!l(this._vbo)||!l(this._ebo)||!l(this._shader))return;const i=this.scene.getActiveCamera();if(!l(i))return;this._shader.bind();const r=e.parentMatrix["*"](this.transform.getMatrix());this._shader.setMat4("MVP",i.vp["*"](r)),this._shader.setVec3("Color",this.color.vec3),o.bindVertexArray(this._vao),o.drawElements(o.LINES,bt.LINE_COUNT,bt.getIndexType(),0),o.bindVertexArray(null)}init(e){!l(this._vao)||!l(this._vbo)||!l(this._ebo)||(o.bindBuffer(o.ARRAY_BUFFER,this._vbo),o.bufferData(o.ARRAY_BUFFER,e.getVertexes(),o.STATIC_DRAW),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this._ebo),o.bufferData(o.ELEMENT_ARRAY_BUFFER,e.getVertexIndexes(),o.STATIC_DRAW),this._boundingBox=e)}get boundingBox(){return this._boundingBox}}ts([E(_e)],Ve.prototype,"color");class vt{}a(vt,"isStatisticScreenOpened",!1),a(vt,"isBoundingBoxRenderingEnabled",!1);class L extends Jt{getType(){return"number"}parseValue(t){return Number(t)}}class ve extends ht{constructor(){super(...arguments);a(this,"_select");a(this,"_container");a(this,"_parser")}static enum(e){return ve.options(e.map(i=>({value:i,label:i})),i=>i)}static options(e,i){return(...r)=>{const s=new ve(...r);return s.setOptions(e),s.setParser(i),s}}setParser(e){this._parser=e}getSelect(){if(!l(this._select)){const e=Zt(!0);this._select=x.select({id:e,onChange:()=>{!l(this._parser)||!l(this._select)||this.saveValue(this._parser(this._select.value))}}),this._container=this.container([x.label({for:e},this.getLabel()),this._select]),this._container.classList.add("type-select")}return this._select}setOptions(e){const i=this.getSelect();i.textContent="";for(const r of e)i.append(new Option(r.label,String(r.value),!1,r.selected??!1))}html(){const e=this.getSelect();return e.value=String(this.readValue()),oi(this._container)}}var is=Object.defineProperty,pi=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&is(t,e,r),r};const vi=new ci,rs=vi.increment(),ss=vi.increment(),ir=vi.increment(),ns=[{label:"Linear",value:rs},{label:"Exponential",value:ss},{label:"Exponential^2",value:ir}];class ye extends K{constructor(){super(...arguments);a(this,"function",ir);a(this,"density",.03);a(this,"functionLinearEnd",100);a(this,"_sky")}bindSkyRenderer(e){this._sky=e}getColor(e=.75){return this._sky.getSunLight().diffuse["*"](e)}getShaderFunction(){return Math.round(this.functionLinearEnd)<<jr|this.function}getFunction(){return this.function}}pi([Yi(ve.options(ns,n=>Number(n)))],ye.prototype,"function");pi([E(L)],ye.prototype,"density");pi([E(L)],ye.prototype,"functionLinearEnd");class zt extends K{constructor(){super(...arguments);a(this,"_shader");a(this,"_meshes");a(this,"_boundingBox");a(this,"_boundingBoxRenderer");a(this,"_timestamp",0)}draw(e){if(!l(this._shader)||!l(this._meshes))return;const i=this.scene.getActiveCamera();if(!l(i))return;const r=this.scene.getSettings().defaultShader==="pbr";(this._shader.bind()||this._timestamp!==this.scene.getTime().getSystemTimestamp())&&this.setSceneLight();const s=e.parentMatrix["*"](this.transform.getMatrix());this._shader.setMat4("Model",s),this._shader.setMat4("MVP",i.vp["*"](s));for(const h of this._meshes)h.bind(),r?this._shader.setMaterialPbr("material",h.getMaterial()):this._shader.setMaterialPhong("material",h.getMaterial()),h.draw();!vt.isBoundingBoxRenderingEnabled||!l(this._boundingBox)||!l(this._boundingBoxRenderer)||this._boundingBoxRenderer.draw(e)}setSceneLight(){if(this._timestamp=this.scene.getTime().getSystemTimestamp(),!l(this._shader))return;this.scene.bindLights(this._shader,"Lights",Nr);const e=this.scene.getActiveCamera();if(!l(e))return;this._shader.setVec3("ViewPosition",e.position);const i=e.gameObject.getComponent(ye);l(i)&&(this._shader.setVec3("fog.color",i.getColor()),this._shader.setFloat("fog.density",i.density),this._shader.setInt("fog.function",i.getShaderFunction()))}getBoundingBox(){return this._boundingBox}delete(){if(l(this._meshes))for(const e of this._meshes)e.delete()}getMeshes(){return this._meshes}async init(e,i=void 0){const r=e.map(f=>new qr(f)),s=bt.initial();for(const f of r)s.merge(f.getBoundingBox());const h=Lt.load(i??await this.scene.getSettings().getDefaultShader());this._meshes=r,this._shader=h,l(i)||this.scene.getSettings().addDefaultShaderListener(()=>{this.scene.getSettings().getDefaultShader().then(f=>{this._shader=Lt.load(f)})}),this._boundingBox=s,this._boundingBoxRenderer=this.gameObject.addComponent(Ve),this._boundingBoxRenderer.init(this._boundingBox)}async initFromModelFile(e){const i=await Nt.load(e);if(!l(i)){console.error("Mesh file not found "+e.getLiteral());return}await this.init(i)}}const Di=V(".stats > .day-time");class as{constructor(t){a(this,"dayDuration",30);a(this,"scale",1);a(this,"dayTime",0);a(this,"_deltaTime",0);a(this,"_systemTimestamp",0);a(this,"_dayDeltaTime",0);this.fixedUpdateMilliseconds=t}update(){const t=Date.now()/1e3;this._deltaTime=t-this._systemTimestamp,this._dayDeltaTime=this._deltaTime*this.scale,this.dayTime+=this._dayDeltaTime/this.dayDuration,this.dayTime-=Math.floor(this.dayTime),this._systemTimestamp=t,this.updateStats()}updateStats(){Ks()||!l(Di)||(Di.textContent="time-day: "+F.round(this.dayTime,3))}getDeltaTime(){return this._deltaTime}getDayDeltaTime(){return this._dayDeltaTime}getSystemTimestamp(){return this._systemTimestamp}getDayTime(){return this.dayTime}setDayTime(t){this.dayTime=t}getFixedDeltaTime(){return this.fixedUpdateMilliseconds/1e3}}const os={w:"forward",s:"backwards",a:"left",d:"right"," ":"up",shift:"down"},X=class X{static register(t){const e=X.registers.get(t.key);if(!l(e)){X.registers.set(t.key.toLowerCase(),[t]);return}e.push(t)}static getMovementVector(){const t=glm.vec3(0,0,0);for(const e of X.movementVector)t.x+=e.x,t.y+=e.y,t.z+=e.z;return glm.normalize(t)}static addMovementDirection(t,e){let i,r;switch(t){case"forward":{i=0,r=y.FORWARD;break}case"backwards":{i=1,r=y.FORWARD["*"](-1);break}case"left":{i=2,r=y.LEFT;break}case"right":{i=3,r=y.LEFT["*"](-1);break}case"up":{i=4,r=y.UP;break}case"down":{i=5,r=y.UP["*"](-1);break}}X.movementVector[i]=e==="up"?glm.vec3(0,0,0):r}static handle(t,e){var s,h,f,m;const i=t.key in X.movementVectorDescription||t.key.toLowerCase()in X.movementVectorDescription;if(e!=="press"&&i){const p=t.key in X.movementVectorDescription?X.movementVectorDescription[t.key]:X.movementVectorDescription[t.key.toLowerCase()];X.addMovementDirection(p,e)}const r=X.registers.get(t.key.toLowerCase());if(l(r))for(const p of r){if(p.key.toLowerCase()!==t.key.toLowerCase())continue;const S=(((s=p.modifiers)==null?void 0:s.includes("ctrl"))??!1)&&!t.ctrlKey,C=(((h=p.modifiers)==null?void 0:h.includes("shift"))??!1)&&!t.shiftKey,I=(((f=p.modifiers)==null?void 0:f.includes("alt"))??!1)&&!t.altKey;if(S||C||I)continue;const R=((m=p.modifiers)==null?void 0:m.length)??0,N=Number(t.altKey)+Number(t.shiftKey)+Number(t.ctrlKey);if(R===N&&(e==="down"?l(p.onDown)&&p.onDown():(l(p.onUp)&&p.onUp(),l(p.onPress)&&p.onPress()),p.preventDefault&&t.preventDefault(),p.stopPropagation)){t.stopPropagation();return}}}static init(){window.addEventListener("keydown",t=>{X.handle(t,"down")}),window.addEventListener("keyup",t=>{X.handle(t,"up")}),window.addEventListener("keypress",t=>{X.handle(t,"press")})}};a(X,"registers",new Map),a(X,"movementVectorDescription",os),a(X,"movementVector",new Array(6).fill(glm.vec3(0,0,0)));let pt=X;var cs=Object.defineProperty,te=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&cs(t,e,r),r};class _t extends K{constructor(){super(...arguments);a(this,"speed",5);a(this,"sensitivity",.05);a(this,"yaw",0);a(this,"pitch",0);a(this,"sceneMin",glm.vec3(-50,-1,-50));a(this,"sceneMax",glm.vec3(50,100,50))}awake(){this.transform.setRotation(Q.fromEulerDegrees(this.pitch,this.yaw,0)),Bt.addEventListener("pointermove",e=>{if(!this.isEnabled()||document.pointerLockElement!==Bt)return;const i=-e.movementX*this.sensitivity,r=e.movementY*this.sensitivity;this.yaw+=i,this.pitch+=r,this.pitch=F.clamp(this.pitch,-89.5,89.5),this.transform.setRotation(Q.fromEuler(glm.radians(this.pitch),glm.radians(this.yaw),0))})}update(){const e=this.speed*this.scene.getTime().getDeltaTime(),i=Q.fromEulerDegrees(0,this.yaw,0)["*"](pt.getMovementVector()),r=this.transform.getPosition()["+"](i["*"](e));this.transform.setPosition(y.clamp(this.sceneMin,this.sceneMax,r))}}te([E(L)],_t.prototype,"speed");te([E(L)],_t.prototype,"sensitivity");te([E(L)],_t.prototype,"yaw");te([E(L)],_t.prototype,"pitch");te([E(Qt)],_t.prototype,"sceneMin");te([E(Qt)],_t.prototype,"sceneMax");var ls=Object.defineProperty,Be=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&ls(t,e,r),r};class be{constructor(){a(this,"doCameraSwitching",!0);a(this,"doRenderSky",!0);a(this,"doRenderGrid",!0);a(this,"defaultShader","pbr");a(this,"_shaderListeners",[])}async getDefaultShader(){const t=await Ut.loadShader(this.defaultShader);if(!l(t))throw new Error("Default Shader not found");return t}addDefaultShaderListener(t){this._shaderListeners.push(t)}onPropertyChange(t,e,i){if(t==="defaultShader")for(const r of this._shaderListeners)r()}}Be([E(It)],be.prototype,"doCameraSwitching");Be([E(It)],be.prototype,"doRenderSky");Be([E(It)],be.prototype,"doRenderGrid");Be([Yi(ve.enum(["phong","pbr"]))],be.prototype,"defaultShader");const hs=20;class rr{constructor(t=""){a(this,"_gameObjects");a(this,"_lights");a(this,"_lightsBuffer");a(this,"_colliders");a(this,"_time");a(this,"_settings");a(this,"_activeCamera");a(this,"_physicsTimestamp");this._name=t,this._lightsBuffer=o.createBuffer(),this._gameObjects=[],this._lights=[],this._colliders=[],this._time=new as(hs),this._settings=new be,this._physicsTimestamp=Date.now()}update(){var t,e;for(;this._physicsTimestamp<Date.now();)this.fixedUpdate(),this._physicsTimestamp+=this._time.fixedUpdateMilliseconds;this._time.update(),(t=this._activeCamera)==null||t.gameObject.update();for(const i of this._gameObjects.values())i!==((e=this._activeCamera)==null?void 0:e.gameObject)&&i.update()}fixedUpdate(){var t,e;(t=this._activeCamera)==null||t.gameObject.fixedUpdate();for(const i of this._gameObjects.values())i!==((e=this._activeCamera)==null?void 0:e.gameObject)&&i.fixedUpdate();this.checkCollision()}checkCollision(){if(!(this._colliders.length<=1))for(let t=0;t<this._colliders.length;t++){const e=this._colliders[t];for(let i=0;i<this._colliders.length;i++){if(t==i)continue;const r=this._colliders[i];e.isColliding(r)&&e.onCollision(r)}}}populateLights(){o.bindBuffer(o.UNIFORM_BUFFER,this._lightsBuffer),o.bufferData(o.UNIFORM_BUFFER,Ur,o.DYNAMIC_DRAW);const t=new Float32Array(ei/Pt);let e=0,i=0;for(const s of this._lights)s.isEnabled()&&(i+=s.getDescription().writeLight(t,i),e++);o.bufferSubData(o.UNIFORM_BUFFER,0,t,0,i*Pt);const r=Int32Array.from([e]);o.bufferSubData(o.UNIFORM_BUFFER,ei,r),o.bindBuffer(o.UNIFORM_BUFFER,null)}bindLights(t,e,i){t.setUniformBlockBinding(e,i),o.bindBuffer(o.UNIFORM_BUFFER,this._lightsBuffer),o.bindBufferBase(o.UNIFORM_BUFFER,i,this._lightsBuffer)}render(){var i;this.populateLights();const t=this.getActiveCamera();if(!l(t))return;t.preRender();const e=new qi(ke.IDENTITY,t);for(const r of this._gameObjects.values())r!==((i=this._activeCamera)==null?void 0:i.gameObject)&&r.render(e)}delete(){for(const t of this._gameObjects)t.delete();o.deleteBuffer(this._lightsBuffer)}get name(){return this._name}getTime(){return this._time}getSettings(){return this._settings}addLight(t){if(this._lights.length>=Ji){console.warn("Action 'addLight' was ignored because it would have exceeded maximum number of lights in scene");return}this._lights.push(t)}deleteLight(t){const e=this._lights.indexOf(t);return e<0?!1:(this._lights.splice(e,1),!0)}addCollider(t){this._colliders.push(t)}deleteCollider(t){const e=this._colliders.indexOf(t);return e<0?!1:(this._colliders.splice(e,1),!0)}addGameObject(t){this._gameObjects.push(t)}deleteGameObject(t){const e=this._gameObjects.findIndex(t);return e<0?!1:(this._gameObjects.splice(e,1),!0)}getGameObjects(){return this._gameObjects.values()}getActiveCamera(){return this._activeCamera}setActiveCamera(t){var r;const e=(r=this._activeCamera)==null?void 0:r.gameObject.getComponent(_t);l(e)&&e.setEnable(!1),this._activeCamera=t;const i=t.gameObject.getComponent(_t);l(i)&&i.setEnable(!0)}async loadGameObject(t,e){const i=new fe(t,void 0,this);if(Nt.isMeshFile(e)){const r=await Nt.load(e);if(!l(r))return console.warn("Mesh file not found "+e.getLiteral()),i;const s=r[0];if(!l(s))return i;await i.addComponent(zt).init([s]);for(let f=1;f<r.length;f++){const m=r[f],p=new fe(m.getName(),void 0,this);await p.addComponent(zt).init([m]),i.transform.addChild(p)}return i}return i}createGameObject(t){return new fe(t,void 0,this)}getSettingsEditorWindow(){const t="__scene-settings__"+this._name,e=V("#"+t);if(l(e))return e;const i=x.div("editor-content"),r=pe(this._name+" settings",i,{isDraggable:!0,isMinimizable:!0,width:"400px"}),s=x.div("component-content");for(const h of Object.keys(this._settings)){const f=$i(r,this._settings,h);l(f)&&s.append(f.html())}return i.append(x.div("component no-hr",[s])),ht.initWindow(r,t)}getGameObjectsWindow(){const t="__scene-gameObjects__"+this._name,e=V("#"+t);if(l(e))return e;const i=x.div("editor-content pad"),r=pe(this._name+" settings",i,{isDraggable:!0,isMinimizable:!0,width:"400px"});for(const s of this._gameObjects)i.append(x.button({onClick:()=>Rt(s.getEditorWindow())},s.name));return ht.initWindow(r,t)}}class Fi{constructor(t,e){this.parentMatrix=t,this.ray_w=e}}class ds{constructor(t,e){this.start=t,this.direction=e}getStart(){return this.start}getEnd(){return this.start["+"](this.direction)}setStart(t){this.start=t}getDirection(){return this.direction}setDirection(t){this.direction=t}getVertexLayout(){return qt}getData(){const t=new Float32Array(qt.getTotalFloats()*2);let e=0;t[e++]=this.start.x,t[e++]=this.start.y,t[e++]=this.start.z;const i=this.getEnd();return t[e++]=i.x,t[e++]=i.y,t[e++]=i.z,t}testGameObject(t,e){const i=t.getComponent(Ve);if(!l(i))return Number.POSITIVE_INFINITY;const r=i.boundingBox;if(!l(r))return Number.POSITIVE_INFINITY;const s=r.getLow(),h=r.getHigh(),f=glm.inverse(e.parentMatrix["*"](t.transform.getMatrix())),m=f["*"](e.ray_w.start),p=f["*"](e.ray_w.direction),S=glm.vec3((s.x-m.x)/p.x,(s.y-m.y)/p.y,(s.z-m.z)/p.z),C=glm.vec3((h.x-m.x)/p.x,(h.y-m.y)/p.y,(h.z-m.z)/p.z),I=Math.max(Math.min(S.x,C.x),Math.min(S.y,C.y),Math.min(S.z,C.z)),R=Math.min(Math.max(S.x,C.x),Math.max(S.y,C.y),Math.max(S.z,C.z));return I<=R&&I>=0?I:Number.POSITIVE_INFINITY}test(t,e,i){let r={closest:void 0,closestDistance:i},s=this.testGameObject(t,e);s<i&&(r.closest=t,r.closestDistance=s);const h=t.transform.getChildren();if(h.length===0)return r;const f=new Fi(e.parentMatrix["*"](t.transform.getMatrix()),e.ray_w);for(const m of h){const p=m.gameObject;if(!l(p))continue;const S=this.test(p,f,r.closestDistance);S.closestDistance<r.closestDistance&&(r=S)}return r}cast(t){let e={closest:void 0,closestDistance:Number.POSITIVE_INFINITY};const i=new Fi(ke.IDENTITY,{start:Oe.convertPoint3(this.start),direction:Oe.convertVector3(this.direction)});for(const r of t.getGameObjects()){const s=this.test(r,i,e.closestDistance);s.closestDistance<e.closestDistance&&(e=s)}return e}intersectSphere(t,e){const i=this.start["-"](t),r=2*glm.dot(i,this.direction),s=glm.dot(i,i)-e*e,h=r*r-4*s;if(h<0)return{close:Number.MAX_VALUE,distance:0};const f=Math.sqrt(h),m=Math.max(0,(-r-f)/2),p=(-r+f)/2;return p<0?{close:Number.MAX_VALUE,distance:0}:{close:m,distance:p-m}}intersectPlane(t,e){const i=glm.dot(this.direction,e);if(Math.abs(i)<1e-4)return Number.MAX_VALUE;const r=-glm.dot(t,e);return-(glm.dot(this.start,e)+r)/i}}var us=Object.defineProperty,we=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&us(t,e,r),r};class ee extends K{constructor(){super(...arguments);a(this,"_target");a(this,"_shader");a(this,"gridSize",100);a(this,"cellSize",.5);a(this,"cellGap",2);a(this,"lineColorThick",Y.vec3(.5,.5,.5));a(this,"lineColorThin",Y.vec3(.3,.3,.3))}render(){const e=this.scene.getActiveCamera();!l(e)||!l(this._shader)||!l(this._target)||(o.disable(o.CULL_FACE),this._shader.bind(),this._shader.setMat4("VP",e.vp),this._shader.setVec3("TargetPosition",this._target.getPosition()),this._shader.setFloat("GridSize",this.gridSize),this._shader.setFloat("CellSize",this.cellSize),this._shader.setFloat("CellGap",this.cellGap),this._shader.setVec3("LineColorThick",this.lineColorThick.vec3),this._shader.setVec3("LineColorThin",this.lineColorThin.vec3),this._shader.setVec3("CameraPosition",e.position),o.drawArrays(o.TRIANGLES,0,6),o.enable(o.CULL_FACE),o.cullFace(o.BACK))}async init(e){this._target=e;const i=await Ut.loadShader("grid");if(!l(i)){console.warn("Grid shader not found");return}this._shader=Lt.load(i)}}we([E(L)],ee.prototype,"gridSize");we([E(L)],ee.prototype,"cellSize");we([E(L)],ee.prototype,"cellGap");we([E(_e)],ee.prototype,"lineColorThick");we([E(_e)],ee.prototype,"lineColorThin");var fs=Object.defineProperty,Gt=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&fs(t,e,r),r};const gs=(n,t)=>glm.vec3(0,Math.sin(n.getDayTime()*2*Math.PI)*t.atmosphereHeight*2,Math.cos(n.getDayTime()*2*Math.PI)*t.atmosphereHeight*2);class xt extends K{constructor(){super(...arguments);a(this,"_target");a(this,"_shader");a(this,"cubeSize",250);a(this,"atmosphereHeight",100);a(this,"wavelengths",glm.vec3(700,530,440));a(this,"scatteringStrength",.4);a(this,"atmosphereFalloff",.2);a(this,"lightPoints",6);a(this,"opticalDepthPoints",6);a(this,"_solarPath",gs);a(this,"lightDescriptions",[{time:0,ambient:y.rgb(10,10,20),diffuse:y.rgb(5,5,10),specular:y.rgb(20,20,30)},{time:.05,ambient:y.rgb(255,147,41),diffuse:y.rgb(255,147,41),specular:y.rgb(255,255,255)},{time:.1,ambient:y.rgb(255,230,200),diffuse:y.rgb(255,230,200),specular:y.rgb(255,255,245)},{time:.25,ambient:y.rgb(255,255,255),diffuse:y.rgb(255,255,255),specular:y.rgb(255,255,255)},{time:.375,ambient:y.rgb(255,230,200),diffuse:y.rgb(255,230,200),specular:y.rgb(255,255,245)},{time:.45,ambient:y.rgb(255,147,41),diffuse:y.rgb(255,147,41),specular:y.rgb(255,255,255)},{time:.5,ambient:y.rgb(30,30,40),diffuse:y.rgb(20,20,30),specular:y.rgb(50,50,60)},{time:.75,ambient:y.rgb(5,5,15),diffuse:y.rgb(2,2,8),specular:y.rgb(10,10,20)}])}awake(){this.gameObject.addComponent(ye).bindSkyRenderer(this)}render(){const e=this.scene.getActiveCamera();!l(e)||!l(this._shader)||!l(this._target)||(this._shader.bind(),this._shader.setMat4("VP",e.vp),this._shader.setVec3("TargetPosition",this._target.getPosition()),this._shader.setFloat("CubeSize",this.cubeSize),this._shader.setVec3("CameraPosition",e.position),this._shader.setVec3("SunPosition",this.getSunPosition()),this._shader.setVec3("Scattering",this.getInverseWavelengths()),this._shader.setFloat("AtmosphereHeight",this.atmosphereHeight),this._shader.setFloat("DensityFalloff",this.atmosphereFalloff),this._shader.setInt("LightPoints",this.lightPoints),this._shader.setInt("OpticalDepthPoints",this.opticalDepthPoints),o.drawArrays(o.TRIANGLES,0,36))}setSunPosition(e){this._solarPath=e}getSunPosition(){return this._solarPath(this.scene.getTime(),this)}getSunLight(){const e=this.scene.getTime().getDayTime();let i=this.lightDescriptions.length-1,r=0;for(let m=0;m<this.lightDescriptions.length;m++)if(this.lightDescriptions[m].time>e){i=m-1,r=m;break}if(i>=this.lightDescriptions.length&&(i-=this.lightDescriptions.length),r>=this.lightDescriptions.length&&(r-=this.lightDescriptions.length),i===r)return this.lightDescriptions[i];const s=this.lightDescriptions[i],h=this.lightDescriptions[r],f=r<i?F.normalize(s.time,1,e):F.normalize(s.time,h.time,e);return{ambient:F.lerpColor(s.ambient,h.ambient,f),diffuse:F.lerpColor(s.diffuse,h.diffuse,f),specular:F.lerpColor(s.specular,h.specular,f)}}getInverseWavelengths(){return glm.vec3(Math.pow(180/this.wavelengths.x,4)*this.scatteringStrength,Math.pow(180/this.wavelengths.y,4)*this.scatteringStrength,Math.pow(180/this.wavelengths.z,4)*this.scatteringStrength)}async init(e){this._target=e;const i=await Ut.loadShader("sky");if(!l(i)){console.warn("Sky renderer not found");return}this._shader=Lt.load(i)}}Gt([E(L)],xt.prototype,"cubeSize");Gt([E(L)],xt.prototype,"atmosphereHeight");Gt([E(Qt)],xt.prototype,"wavelengths");Gt([E(L)],xt.prototype,"scatteringStrength");Gt([E(L)],xt.prototype,"atmosphereFalloff");Gt([E(L)],xt.prototype,"lightPoints");Gt([E(L)],xt.prototype,"opticalDepthPoints");var ms=Object.defineProperty,_i=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&ms(t,e,r),r},At;const je=(At=class extends K{constructor(){super(...arguments);a(this,"fov",60);a(this,"near",.1);a(this,"far",500);a(this,"_gridRenderer");a(this,"_skyRenderer");a(this,"_view");a(this,"_vp");a(this,"_projection")}awake(){this.updateProjection(),this.updateView(),this.assignKeyRegister(),this._skyRenderer=this.gameObject.addComponent(xt),this._skyRenderer.init(this.transform).then(),this._gridRenderer=this.gameObject.addComponent(ee),this._gridRenderer.init(this.transform).then(),this.gameObject.hasComponent(zt)||this.gameObject.addComponent(zt).initFromModelFile(O.from("/assets/models/camera.obj")).then(),window.addEventListener("resize",()=>{this.updateProjection()})}updateProjection(){const e=Bt.getBoundingClientRect(),i=e.width/e.height;this._projection=glm.perspective(glm.radians(this.fov),i,this.near,this.far)}assignKeyRegister(){At.keyCounter.peek()>9||pt.register({key:String(At.keyCounter.increment()),onPress:()=>{this.scene.getSettings().doCameraSwitching&&this.scene.setActiveCamera(this)}})}update(){this.updateView()}preRenderSky(){this.scene.getSettings().doRenderSky&&l(this._skyRenderer)&&this._skyRenderer.render()}preRenderGrid(){this.scene.getSettings().doRenderGrid&&l(this._gridRenderer)&&this._gridRenderer.render()}preRender(){this.preRenderSky(),this.preRenderGrid()}get position(){return this.transform.getWorldPosition()}get vp(){return this._vp}updateView(){const e=this.gameObject.transform,i=glm.normalize(e.getForward()),r=glm.normalize(e.getUp()),s=e.getWorldPosition();this._view=glm.lookAt(s,s["+"](i),r),this._vp=this._projection["*"](this._view)}screenPositionToWorldRay(e){const i=glm.vec4(e.x/Bt.width*2-1,1-e.y/Bt.height*2,-1,1),r=glm.inverse(this._projection)["*"](i);r.z=-1,r.w=0;const s=glm.normalize(glm.inverse(this._view)["*"](r));return new ds(glm.vec3(this.transform.getWorldPosition()),glm.vec3(s))}setFov(e){return this.fov=e,this.updateProjection(),this}onPropertyChange(e,i,r){(e==="fov"||e==="near"||e==="far")&&this.updateProjection()}},a(At,"keyCounter",new ci(1)),At);_i([E(L)],je.prototype,"fov");_i([E(L)],je.prototype,"near");_i([E(L)],je.prototype,"far");let Re=je;class ps extends K{constructor(){super(...arguments);a(this,"target")}update(){l(this.target)&&this.transform.lookAtTransform(this.target.transform)}setTarget(e){this.target=e}}class sr extends ht{constructor(e,i,r,s){super(e,i,r,s);a(this,"button");this.button=x.button({class:"editor-button",onClick:s.bind(i)},this.getLabel())}html(){return x.div(tt,this.button)}}var vs=Object.defineProperty,Wt=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&vs(t,e,r),r};class Dt extends K{constructor(){super(...arguments);a(this,"effectedByGravity",!1);a(this,"mass",1);a(this,"drag",.05);a(this,"dragAngular",.05);a(this,"_velocity",y.clone(y.ZERO));a(this,"_velocityAngular",y.clone(y.ZERO));a(this,"velocity",y.clone(y.ZERO));a(this,"velocityAngular",y.clone(y.ZERO));a(this,"Add_Velocity",this.applyVelocity)}applyVelocity(){this.addVelocity(this.velocity),this.addVelocityAngular(this.velocityAngular)}fixedUpdate(){const e=this.scene.getTime().getFixedDeltaTime(),i=this.transform.getPosition();this.transform.setPosition(i["+"](this._velocity["*"](e))),this._velocity["-="](this._velocity["*"](this.drag)),glm.dot(this._velocity,this._velocity)<1e-5&&(this._velocity=y.clone(y.ZERO));const r=this.transform.getRotation(),s=glm.quat(0,this._velocityAngular.x*e,this._velocityAngular.y*e,this._velocityAngular.z*e);s["*="](r),r.w+=s.w,r.x+=s.x,r.y+=s.y,r.z+=s.z,this.transform.setRotation(glm.normalize(r)),this._velocityAngular["-="](this._velocityAngular["*"](this.dragAngular)),glm.dot(this._velocityAngular,this._velocityAngular)<1e-5&&(this._velocityAngular=y.clone(y.ZERO))}addVelocity(e){this._velocity["+="](e)}addVelocityAngular(e){this._velocityAngular["+="](e)}}Wt([E(It)],Dt.prototype,"effectedByGravity");Wt([E(L)],Dt.prototype,"mass");Wt([E(L)],Dt.prototype,"drag");Wt([E(L)],Dt.prototype,"dragAngular");Wt([E(Qt)],Dt.prototype,"velocity");Wt([E(Qt)],Dt.prototype,"velocityAngular");Wt([E(sr)],Dt.prototype,"Add_Velocity");const _s=0,ys=1,bs=2,ws=4,xs=8,Es=12;class Ms{constructor(t,e,i,r,s,h){this.type=t,this.position=e,this.direction=i,this.color=r,this.intensity=s,this.cosAngle=h}writeLight(t,e){return t.byteLength<e*Pt+ti?0:(t[e+_s]=this.type,t[e+ys]=this.intensity,t[e+bs]=this.cosAngle,k.writeVec3(t,e+ws,this.position),k.writeVec3(t,e+xs,this.color.vec3),k.writeVec3(t,e+Es,glm.normalize(this.direction)),ti)}}var Ts=Object.defineProperty,nr=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&Ts(t,e,r),r};const Cs=0;class xe extends K{constructor(){super(...arguments);a(this,"color",Y.vec3(1,1,1));a(this,"intensity",1)}awake(){this.scene.addLight(this)}destroy(){this.scene.deleteLight(this)}getDescription(){return new Ms(Cs,this.transform.getWorldPosition(),glm.vec3(0,0,0),this.color,this.intensity,0)}}nr([E(_e)],xe.prototype,"color");nr([E(L)],xe.prototype,"intensity");var Ss=Object.defineProperty,Rs=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&Ss(t,e,r),r};const Ps=2;class de extends xe{constructor(){super(...arguments);a(this,"angle",15)}getDescription(){const e=super.getDescription();return e.type=Ps,e.direction=glm.vec3(this.transform.getMatrix()["*"](Oe.convertVector3(y.FORWARD))),e.cosAngle=Math.cos(glm.radians(this.angle)),e}}Rs([E(L)],de.prototype,"angle");var As=Object.defineProperty,Os=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&As(t,e,r),r};class Le extends K{constructor(){super(...arguments);a(this,"_sections",10);a(this,"_segments",[])}addSegment(e){this._segments.push(e)}get segments(){return this._segments}get sections(){return Math.round(this._sections)}get length(){return this._segments.length*(this.sections+1)}generateBuffer(e=bt.initial()){const i=this.sections,r=new Float32Array(qt.getTotalFloats()*this._segments.length*(i+1));let s=0;for(const h of this._segments)for(let f=0;f<=i;f++){const m=h.getPoint(f/i);s=k.writeVec3(r,s,m),e.add(m)}return r}getPoint(e){const i=1/this._segments.length,r=Math.floor(e/i),s=e%i/i;return this._segments[r].getPoint(s)["+"](this.transform.getWorldPosition())}}Os([E(L)],Le.prototype,"_sections");class qe{constructor(t,e,i,r){this.a=t,this.b=e,this.c=i,this.d=r}getPoint(t){const e=y.lerp(this.a,this.b,t),i=y.lerp(this.b,this.c,t),r=y.lerp(this.c,this.d,t),s=y.lerp(e,i,t),h=y.lerp(i,r,t);return y.lerp(s,h,t)}}var Ls=Object.defineProperty,Is=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&Ls(t,e,r),r};class si extends K{constructor(){super(...arguments);a(this,"color",Y.vec3(1,1,1));a(this,"_spline");a(this,"_splineLength",-1);a(this,"_splineLines",0);a(this,"_boundingBox");a(this,"_boundingBoxRenderer");a(this,"_vao");a(this,"_vbo");a(this,"_shader")}awake(){if(this._spline=this.gameObject.getComponent(Le),!l(this._spline))throw new Error("No spline found on game object. Before adding SplineRenderer you must add Spline component");this._boundingBoxRenderer=this.gameObject.addComponent(Ve),this._vao=o.createVertexArray(),o.bindVertexArray(this._vao),this._vbo=o.createBuffer(),this.updateBuffer(),o.bindBuffer(o.ARRAY_BUFFER,this._vbo),o.enableVertexAttribArray(0),o.vertexAttribPointer(0,qt.getVertexFloats(),o.FLOAT,!1,0,0),o.bindVertexArray(null),Ut.loadShader("ray").then(e=>{if(!l(e)){console.warn("Ray shader not found");return}this._shader=Lt.load(e)})}updateBuffer(){if(!l(this._spline)||!l(this._vbo)||this._splineLength===this._spline.length)return;this._boundingBox=bt.initial();const e=this._spline.generateBuffer(this._boundingBox);o.bindBuffer(o.ARRAY_BUFFER,this._vbo),o.bufferData(o.ARRAY_BUFFER,e,o.STATIC_DRAW),this._splineLength=this._spline.length,this._splineLines=e.length/qt.getTotalFloats(),l(this._boundingBoxRenderer)&&this._boundingBoxRenderer.init(this._boundingBox),o.bindBuffer(o.ARRAY_BUFFER,null)}draw(e){if(!l(this._vao)||!l(this._vbo)||!l(this._shader))return;this.updateBuffer();const i=this.scene.getActiveCamera();if(!l(i))return;this._shader.bind();const r=e.parentMatrix["*"](this.transform.getMatrix());this._shader.setMat4("MVP",i.vp["*"](r)),this._shader.setVec3("Color",this.color.vec3),o.bindVertexArray(this._vao),o.bindBuffer(o.ARRAY_BUFFER,this._vbo),o.drawArrays(o.LINE_STRIP,0,this._splineLines),o.bindVertexArray(null),!(!vt.isBoundingBoxRenderingEnabled||!l(this._boundingBox)||!l(this._boundingBoxRenderer))&&this._boundingBoxRenderer.draw(e)}getBoundingBox(){return this._boundingBox}delete(){Qi(this._vao),ii(this._vbo)}}Is([E(_e)],si.prototype,"color");var Ds=Object.defineProperty,ar=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&Ds(t,e,r),r};class Ie extends K{constructor(){super(...arguments);a(this,"log",!1);a(this,"duration",5);a(this,"_path");a(this,"_t",0)}update(){if(this._t+=this.scene.getTime().getDeltaTime()/5,this._t-=Math.floor(this._t),!l(this._path))return;this.transform.setPosition(this._path.getPoint(this._t));const e=1/this._path.segments.length,i=Math.floor(this._t/e),r=this._t%e;this.log&&console.log(i,r)}setPath(e){this._path=e}}ar([E(It)],Ie.prototype,"log");ar([E(L)],Ie.prototype,"duration");class Fs extends ht{constructor(){super(...arguments);a(this,"x");a(this,"y")}createCombo(e,i){const r=Zt(!0);i.id=r;const s=x.label({for:r},e);return Jt.enableNumberScrolling(s,i),x.div(tt,[s,i])}saveVector(){this.saveValue(glm.vec3(Number(this.x.value),Number(this.y.value)))}update(){const e=this.readValue();this.x.value=String(e.x),this.y.value=String(e.y)}html(){return this.x=x.input({type:"number",value:this.value.x,onInput:()=>this.saveVector()}),this.y=x.input({type:"number",value:this.value.y,onInput:()=>this.saveVector()}),this.container([x.span(tt,this.getLabel()),x.div("vec3",[this.createCombo("X",this.x),this.createCombo("Y",this.y)])])}}class ks{static random(){const t=Math.random()*2*Math.PI;return glm.vec2(Math.cos(t),Math.sin(t))}}class ki{constructor(){a(this,"cache");this.cache=new Map}set(t,e,i){let r=this.cache.get(t);l(r)||this.cache.set(t,r=new Map),r.set(e,i)}get(t,e,i=void 0){const r=this.cache.get(t);if(!l(r))return i;const s=r.get(e);return l(s)?s:i}}const Ct=class Ct{static gridDotProductAt(t,e,i,r){let s=Ct.gradients.get(i,r);l(s)||Ct.gradients.set(i,r,s=ks.random());const h=glm.vec2(t-i,e-r);return glm.dot(s,h)}static noise(t,e){const i=Ct.cache.get(t,e);if(l(i))return i;const r=Math.floor(t),s=Math.floor(e),h=this.gridDotProductAt(t,e,r,s),f=this.gridDotProductAt(t,e,r+1,s),m=this.gridDotProductAt(t,e,r,s+1),p=this.gridDotProductAt(t,e,r+1,s+1),S=F.lerp(h,f,F.smoothStep(t-r)),C=F.lerp(m,p,F.smoothStep(t-r)),I=F.lerp(S,C,F.smoothStep(e-s));return Ct.cache.set(t,e,I),I}};a(Ct,"gradients",new ki),a(Ct,"cache",new ki);let ni=Ct;class Vs{constructor(t,e){a(this,"_canvas");a(this,"_context");a(this,"_data");this.width=t,this.height=e,this._canvas=x.canvas({width:t,height:e}),this._context=this._canvas.getContext("2d"),this._data=this._context.createImageData(t,e)}setPixel(t,e,i){const r=(e*this.width+t)*4;this._data.data[r]=i.r,this._data.data[r+1]=i.g,this._data.data[r+2]=i.b,this._data.data[r+3]=i.a}toDataUrl(){return this._context.putImageData(this._data,0,0),this._canvas.toDataURL()}}var Bs=Object.defineProperty,Ht=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&Bs(t,e,r),r};class wt extends K{constructor(){super(...arguments);a(this,"generateOnAwake",!0);a(this,"generateOnPropertyWrite",!0);a(this,"height",2);a(this,"size",glm.vec2(10,10));a(this,"scale",1);a(this,"offset",0);a(this,"_meshRenderer");a(this,"_Generate",this.generate)}awake(){this._meshRenderer=this.gameObject.getComponent(zt)??this.gameObject.addComponent(zt),this.generateOnAwake&&this.generate()}triangleNormal(e,i,r){return glm.cross(e["-"](i),e["-"](r))}generate(){if(!l(this._meshRenderer)){console.warn("MeshRenderer component is not added to the "+this.gameObject.name+" game object");return}const e=this.size.x*this.size.y,i=(this.size.x-1)*(this.size.y-1)*2,r=new Array(e),s=bt.initial(),h=new Vs(this.size.x,this.size.y);let f=0;for(let R=0;R<this.size.y;R++)for(let N=0;N<this.size.x;N++){const it=ni.noise((N+this.offset)/(this.size.x*this.scale),(R+this.offset)/(this.size.y*this.scale))*this.height,G=r[f++]=glm.vec3(N,it,R);s.add(G);const D=it/this.height/2+.5;h.setPixel(N,R,Y.vec3(D/2,D,D/2))}const m=new Float32Array(j.getTotalFloats()*i*3),p=j.getVertexFloats(),S=j.getNormalFloats();let C=0;for(let R=0;R<this.size.y-1;R++){const N=R+1,it=R/this.size.y,G=N/this.size.y;for(let D=0;D<this.size.x-1;D++){const rt=D+1,ct=1-D/this.size.x,ft=1-rt/this.size.x,nt=r[R*this.size.x+D],lt=r[R*this.size.x+rt],et=r[N*this.size.x+D],Ft=r[N*this.size.x+rt],Et=glm.vec2(ct,it),kt=glm.vec2(ft,it),ie=glm.vec2(ct,G),Ee=glm.vec2(ft,G),Xt=this.triangleNormal(lt,nt,et);k.writeVec3(m,C++*j.getTotalFloats(),lt),k.writeVec3(m,C*j.getTotalFloats()+p,Xt),k.writeVec2(m,C*j.getTotalFloats()+p+S,kt),k.writeVec3(m,C++*j.getTotalFloats(),et),k.writeVec3(m,C*j.getTotalFloats()+p,Xt),k.writeVec2(m,C*j.getTotalFloats()+p+S,ie),k.writeVec3(m,C++*j.getTotalFloats(),Ft),k.writeVec3(m,C*j.getTotalFloats()+p,Xt),k.writeVec2(m,C*j.getTotalFloats()+p+S,Ee);const Yt=this.triangleNormal(lt,et,Ft);k.writeVec3(m,C++*j.getTotalFloats(),lt),k.writeVec3(m,C*j.getTotalFloats()+p,Yt),k.writeVec2(m,C*j.getTotalFloats()+p+S,kt),k.writeVec3(m,C++*j.getTotalFloats(),nt),k.writeVec3(m,C*j.getTotalFloats()+p,Yt),k.writeVec2(m,C*j.getTotalFloats()+p+S,Et),k.writeVec3(m,C++*j.getTotalFloats(),et),k.writeVec3(m,C*j.getTotalFloats()+p,Yt),k.writeVec2(m,C*j.getTotalFloats()+p+S,ie)}}const I=h.toDataUrl();Vt.loadImage(I).then(R=>{if(l(R)){if(!l(this._meshRenderer)){console.warn("MeshRenderer component is not added to the "+this.gameObject.name+" game object");return}this._meshRenderer.init([new Nt(m,i,j,R,s,this.gameObject.name)]).then()}})}getTextureEditorWindow(e){const i="__terrain-texture__"+this.gameObject.name,r=V("#"+i);if(l(r))return r;const s=x.div("editor-content pad"),h=pe(this.gameObject.name+" > Terrain texture",s,{isDraggable:!0,isMinimizable:!0,width:"400px"});return s.append(x.img({src:e})),ht.initWindow(h,i)}onPropertyChange(e,i,r){this.generateOnPropertyWrite&&this.generate()}}Ht([E(It)],wt.prototype,"generateOnAwake");Ht([E(It)],wt.prototype,"generateOnPropertyWrite");Ht([E(L)],wt.prototype,"height");Ht([E(Fs)],wt.prototype,"size");Ht([E(L)],wt.prototype,"scale");Ht([E(L)],wt.prototype,"offset");Ht([E(sr)],wt.prototype,"_Generate");const js=1;class Ns extends xe{getDescription(){const t=super.getDescription();return t.type=js,t.direction=this.transform.getForward(),t}}class or extends Ns{awake(){super.awake(),this.intensity=.5}update(){const t=this.scene.getActiveCamera();if(!l(t))return;const e=t.gameObject.getComponent(xt);l(e)&&this.updateLight(e)}updateLight(t){this.color=Y.fromVec3(t.getSunLight().ambient)}getDescription(){const t=super.getDescription();return t.direction=this.transform.getPosition(),t}}class Us extends or{awake(){super.awake(),this.intensity=5}updateLight(t){this.color=Y.fromVec3(t.getSunLight().diffuse),this.transform.setPosition(t.getSunPosition())}getDescription(){const t=super.getDescription();return t.direction=glm.vec3(t.direction)["*"](-1),t}}var zs=Object.defineProperty,yi=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&zs(t,e,r),r};class Ne extends K{constructor(){super(...arguments);a(this,"_meshRenderer");a(this,"width",1);a(this,"height",1);a(this,"images");a(this,"_materials");a(this,"fps",1);a(this,"frame",0);a(this,"time",0);a(this,"onMaterialUpdate",()=>{})}setMaterial(e){if(!l(this._meshRenderer))return;const i=this._meshRenderer.getMeshes();if(l(i))for(const r of i)r.setMaterial(e)}awake(){this.scale(),this._meshRenderer=this.gameObject.addComponent(zt),this._meshRenderer.initFromModelFile(O.from("/assets/models/quad.obj")).then(async()=>{if(l(this.images)){this._materials=[];for(const e of this.images){const i=await Vt.loadImage(e);l(i)&&this._materials.push(new tr(i))}this._materials.length!==0&&this.setMaterial(this._materials[0])}})}getCurrentMaterial(){this.time+=this.scene.getTime().getDeltaTime();const e=1/this.fps,i=Math.floor(this.time/e);if(this.frame+=i,this.time-=i*e,!(i<=0||!l(this._materials)||this._materials.length===0))return this.frame-=Math.floor(this.frame/this._materials.length)*this._materials.length,this._materials[this.frame]}update(){const e=this.getCurrentMaterial();l(e)&&(this.onMaterialUpdate(e,this),this.setMaterial(e))}onPropertyChange(e,i,r){(e==="width"||e==="height")&&this.scale()}scale(){this.transform.setScale(glm.vec3(this.width,1,this.height))}setDimensions(e,i){this.width=e,this.height=i,this.scale()}}yi([E(L)],Ne.prototype,"width");yi([E(L)],Ne.prototype,"height");yi([E(L)],Ne.prototype,"fps");var Gs=Object.defineProperty,Ws=(n,t,e,i)=>{for(var r=void 0,s=n.length-1,h;s>=0;s--)(h=n[s])&&(r=h(t,e,r)||r);return r&&Gs(t,e,r),r};class yt extends K{constructor(){super(...arguments);a(this,"radius",1)}awake(){this.scene.addCollider(this)}delete(){this.scene.deleteCollider(this)}isColliding(e){const i=this.transform.getWorldPosition(),r=e.transform.getWorldPosition();return glm.length(r["-"](i))<=this.radius+e.radius}onCollision(e){const i=this,r=e,s=this.transform.getWorldPosition(),h=e.transform.getWorldPosition(),f=glm.normalize(h["-"](s)),m=s["+"](f["*"](i.radius)),p=s["+"](f["*"](1-r.radius)),S=m["+"](p)["*"](.5);this.transform.setPosition(S["+"](f["*"](-i.radius))),e.transform.setPosition(S["+"](f["*"](r.radius)))}}Ws([E(L)],yt.prototype,"radius");async function Hs(){const n=new rr("DevScene"),t=n.createGameObject("cam0");t.transform.setPosition3(0,.2,-3),n.setActiveCamera(t.addComponent(Re)),t.addComponent(_t),t.addComponent(yt).radius=.25;const e=await n.loadGameObject("suzanne",O.from("/assets/models/Suzanne.obj"));e.transform.setPosition3(1,0,3).setRotation(Q.fromEulerDegrees(-50,180,60)),e.addComponent(Dt),e.addComponent(yt).radius=.25;const i=await n.loadGameObject("sun",O.from("/assets/models/Cube.obj"));i.addComponent(or),i.addComponent(Us),i.transform.setPosition3(0,5,5).setScale3(5,5,5);const r=await n.loadGameObject("cube_001",O.from("/assets/models/Cube.obj"));r.transform.setScale(glm.vec3(.25,.25,.25)).setPosition(glm.vec3(-1,-.5,3)),r.addComponent(yt).radius=.25,e.transform.addChild(r);const s=n.createGameObject("cam1");s.transform.setPosition3(-3,.1,-1),s.addComponent(Re);const h=s.addComponent(ps),f=n.createGameObject("cam2");f.transform.setPosition3(6.6,6.8,-3.2).setRotation(Q.fromEulerDegrees(65,-21,0)),f.addComponent(Re);const m=n.createGameObject("cam2");m.transform.setPosition3(-15.323511123657227,12.194103240966797,20.064395904541016).setRotation(Q.fromEulerDegrees(-155.79981994628906,45.84980392456055,179.99984741210938)),m.addComponent(Re).setFov(15);const p=n.createGameObject("spline_002");p.transform.setPosition3(8,0,0);const S=p.addComponent(Le);S.addSegment(new qe(glm.vec3(0,2,3),glm.vec3(2,0,4),glm.vec3(3,4,0),glm.vec3(4,5,6))),p.addComponent(si),s.addComponent(Ie).setPath(S);const I=await n.loadGameObject("light_000",O.from("/assets/models/Cube.obj"));I.transform.setPosition3(6,.5,0).setScale3(.1,.1,.1);const R=I.addComponent(xe);R.intensity=200,R.color=Y.fromHex("#4da0ff"),I.addComponent(yt).radius=.25;const N=await n.loadGameObject("light_001",O.from("/assets/models/camera.obj"));N.transform.setRotation(Q.fromEulerDegrees(75,0,0)).setPosition3(4,2,-.6);const it=N.addComponent(de);it.color=Y.fromHex("#b40a2b"),it.intensity=200,N.addComponent(yt).radius=.25;const G=n.createGameObject("spline_001");G.transform.setPosition3(12,0,0);const D=G.addComponent(Le);D.addSegment(new qe(glm.vec3(1,0,1),glm.vec3(2,2,0),glm.vec3(0,4,4),glm.vec3(4,4,0))),D.addSegment(new qe(glm.vec3(4,4,0),glm.vec3(2,0,4),glm.vec3(3,4,0),glm.vec3(4,5,6))),G.addComponent(si);const rt=await n.loadGameObject("light_000",O.from("/assets/models/Cube.obj"));rt.transform.setScale3(.25,.25,.25),rt.addComponent(Ie).setPath(D),h.setTarget(rt);const ft=n.createGameObject("terrain_001");ft.transform.setPosition3(0,.5,5).setScale3(.1,.1,.1);const nt=ft.addComponent(wt);nt.height=4,nt.size=glm.vec2(20,20),nt.scale=.3,nt.generate();const lt=n.createGameObject("terrain_002");lt.transform.setPosition3(3,.5,5).setScale3(.1,.1,.1);const et=lt.addComponent(wt);et.height=8,et.size=glm.vec2(20,20),et.scale=.4,et.offset=1234,et.generate();const Ft=n.createGameObject("baussi");Ft.transform.setRotation(Q.fromEulerDegrees(0,180,0)).setPosition3(5,.1,0);const Et=Ft.addComponent(Ne),kt=[];for(let M=0;M<381;M++){const gt=String(M).padStart(3,"0");kt.push(`/assets/sprites/baussi/frame_${gt}_delay-0.04s.png`)}Et.images=kt,Et.fps=25,Et.setDimensions(4,2),Et.onMaterialUpdate=(M,gt)=>{const Te=gt.scene.getTime().getSystemTimestamp();M.textureOffset=glm.vec2(Math.cos(2*Te)/2,Math.sin(2*Te)/2)},(await n.loadGameObject("nodeLarge",O.from("/assets/models/node-large.obj"))).transform.setPosition3(-3,1,0),(await n.loadGameObject("nodeMedium",O.from("/assets/models/node-medium.obj"))).transform.setPosition3(-5,1,0),(await n.loadGameObject("nodeSmall",O.from("/assets/models/node-small.obj"))).transform.setPosition3(-7,1,0),(await n.loadGameObject("tree",O.from("/assets/models/tree.obj"))).transform.setPosition3(-9,1,0),(await n.loadGameObject("pickaxe",O.from("/assets/models/pickaxe.obj"))).transform.setPosition3(-11,1,0),(await n.loadGameObject("powerPlant",O.from("/assets/models/powerplant.obj"))).transform.setPosition3(0,0,-20).setScale3(100,100,100);const re=await n.loadGameObject("light_002",O.from("/assets/models/camera.obj"));re.transform.setPosition3(1.8164747953414917,6.876829624176025,-11.663747787475586).setRotation(Q.fromEulerDegrees(-120.45005798339844,-26.00025177001953,-179.99984741210938));const se=re.addComponent(de);se.color=Y.fromHex("#ff0000"),se.intensity=1e4,N.addComponent(yt).radius=.25;const ne=await n.loadGameObject("light_003",O.from("/assets/models/camera.obj"));ne.transform.setPosition3(-1.6248395442962646,4.1641364097595215,-13.236002922058105).setRotation(Q.fromEulerDegrees(-114.60015106201172,18.700197219848633,179.99984741210938));const ae=ne.addComponent(de);ae.color=Y.fromHex("#00ff00"),ae.intensity=500,N.addComponent(yt).radius=.25;const oe=await n.loadGameObject("light_004",O.from("/assets/models/camera.obj"));oe.transform.setPosition3(.7631348967552185,1.825176477432251,-12.153656005859375).setRotation(Q.fromEulerDegrees(-157.05001831054688,-16.749849319458008,-179.99984741210938));const ce=oe.addComponent(de);return ce.color=Y.fromHex("#0000ff"),ce.intensity=750,N.addComponent(yt).radius=.25,ut==null||ut.click(),n.getTime().setDayTime(.3),n.getTime().scale=0,n}const ai="hw";function Vi(){const n="help-window",t=V("#"+n);if(l(t))return t;const e=pe("Help",x.div("help-content",[x.h3(tt,"General"),x.div("description",["Dynamic cameras are controllable after clicking on the screen thus entering ",x.b(tt,"Dynamic View")]),x.div("divider"),x.div("description","Picking can be done outside Dynamic View with right mouse button. Successful picking will result in showing editor window for selected object"),x.div("divider"),x.h3(tt,"Keyboard shortcuts"),st("CTRL + H","Show help (this window)"),st("F1","Show scene settings"),st("F2","Show scene graph (only the top level objects)"),st("F3","Debug statistics"),st("1","Dynamic camera"),st("2-4","Switch to static camera"),st("F","Show hit-boxes"),x.div("divider"),x.h3(tt,"Dynamic View"),st("W","Go forward"),st("A","Go left"),st("S","Go backwards"),st("D","Go right"),st("SPACE","Go up"),st("SHIFT","Go down"),st("ESC","Exit Dynamic View")]),{isDraggable:!0,isMinimizable:!0,width:"400px"});return e.addEventListener(hi,()=>{localStorage.setItem(ai,String(!1))}),e.addEventListener(li,()=>{localStorage.setItem(ai,String(!0))}),ht.initWindow(e,n)}function Xs(){return JSON.parse(localStorage.getItem(ai)??"true")}function st(n,t){return x.div("shortcut",[x.span("key",n),x.span("description",t)])}const ot=V("#viewport");if(!l(ot))throw new Error("Could not locate main viewport");const Bt=ot;function cr(){if(!l(ot))return;const n=ot.getBoundingClientRect();ot.width=Math.floor(n.width),ot.height=Math.floor(n.height),o.viewport(0,0,ot.width,ot.height)}const lr=ot==null?void 0:ot.getContext("webgl2");if(!l(lr))throw new Error("Could not load WebGL context");const o=lr;cr();window.addEventListener("resize",cr);let q=new rr("default_scene");async function Ys(){pt.init(),pt.register({key:"H",modifiers:["ctrl"],onPress:()=>Rt(Vi()),preventDefault:!0,stopPropagation:!0}),pt.register({key:"F3",onPress:()=>vt.isStatisticScreenOpened=!vt.isStatisticScreenOpened,preventDefault:!0,stopPropagation:!0}),pt.register({key:"F1",onPress:()=>Rt(q.getSettingsEditorWindow()),preventDefault:!0,stopPropagation:!0}),pt.register({key:"F2",onPress:()=>Rt(q.getGameObjectsWindow()),preventDefault:!0,stopPropagation:!0}),pt.register({key:"f",onPress:()=>vt.isBoundingBoxRenderingEnabled=!vt.isBoundingBoxRenderingEnabled,preventDefault:!0}),o.enable(o.DEPTH_TEST),o.depthFunc(o.LEQUAL),o.enable(o.CULL_FACE),o.cullFace(o.BACK),o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),q.delete(),q=await Hs(),Xs()&&Rt(Vi())}async function $s(){q.update()}async function qs(){const n=.09019607843137255;o.clearColor(n,n,n,1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),q.render()}Bt.addEventListener("contextmenu",n=>{const t=q.getActiveCamera();if(!l(t))return;n.preventDefault();const i=t.screenPositionToWorldRay(glm.vec2(n.clientX,n.clientY)).cast(q);if(!l(i.closest)){Rt(t.gameObject.getEditorWindow());return}Rt(i.closest.getEditorWindow())});Bt.addEventListener("click",async()=>{const n=q.getActiveCamera();!l(n)||!n.gameObject.hasComponent(_t)||(await ot.requestPointerLock(),ot.focus())});const St=V(".play"),ut=V(".pause"),Mt=V(".time-input > input");l(Mt)&&(Mt.value=String(.25),Mt.addEventListener("input",()=>{q.getTime().setDayTime(Number(Mt.value))}),Mt.addEventListener("pointerdown",n=>{Mt.setPointerCapture(n.pointerId),ut==null||ut.click()}),Mt.addEventListener("pointerup",n=>{Mt.releasePointerCapture(n.pointerId),St==null||St.click()}));if(l(St)&&l(ut)){let n=q.getTime().scale;St.classList.add("hide"),St.addEventListener("click",()=>{ut.classList.remove("hide"),St.classList.add("hide"),q.getTime().scale=n}),ut.addEventListener("click",()=>{St.classList.remove("hide"),ut.classList.add("hide"),n>1e-6&&q.getTime().scale>1e-6&&(n=q.getTime().scale),q.getTime().scale=0}),ut.click(),q.getTime().setDayTime(.25)}let he=1,Ae=0;function Ks(){return vt.isStatisticScreenOpened||Date.now()-Ae<1e3}let Ke=0,Ze=0,Je=0;const Qe=V(".stats"),Bi=V(".stats .update"),ji=V(".stats .render"),Ni=V(".stats .fps");function hr(){const n=!vt.isStatisticScreenOpened;Qe==null||Qe.classList.toggle("hide",n);const t=Date.now();$s().then(async()=>{const e=Date.now(),i=e-Ae>=1e3&&!n;Ke+=Math.round(e-t),l(Bi)&&i&&(Bi.textContent="update: "+F.round(Ke/he,2)+"ms");const r=e;await qs();const s=Date.now();Ze+=Math.round(s-r),Je+=Math.round(1e3/Math.round(s-t)),l(ji)&&i&&(ji.textContent="render: "+F.round(Ze/he,2)+"ms"),l(Ni)&&i&&(Ni.textContent=F.round(Je/he,2)+" fps"),e-Ae>=1e3&&(Ae=s,he=Ke=Ze=Je=0),he++,requestAnimationFrame(hr)})}Ys().then(()=>{hr()});
